name: Speakeasy SDK Generation (Parallel Testing)

on:
  workflow_dispatch:
    inputs:
      force:
        description: 'Force regeneration'
        required: false
        type: boolean
  push:
    branches:
      - main
    paths:
      - 'docs/swagger/**'
      - '.speakeasy/**'

permissions:
  contents: write
  pull-requests: write

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Setup Speakeasy
        uses: speakeasy-api/sdk-generation-action@v15
        with:
          speakeasy_version: latest
          workspace_url: ${{ secrets.SPEAKEASY_WORKSPACE_URL }}
          
      - name: Authenticate Speakeasy
        env:
          SPEAKEASY_API_KEY: ${{ secrets.SPEAKEASY_API_KEY }}
        run: |
          speakeasy auth login --api-key $SPEAKEASY_API_KEY
          
      - name: Generate SDKs
        run: |
          speakeasy run
          
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "chore: regenerate SDKs with Speakeasy"
          branch: speakeasy-sdk-update
          title: "SDK Update from Speakeasy"
          body: |
            ## SDK Generation Summary
            
            This PR contains SDK updates generated by Speakeasy.
            
            ### Changed Files
            - Go SDK: api/go
            - Python SDK: api/python
            - JavaScript SDK: api/javascript
            
            ### Verification Steps
            - [ ] Run tests for all SDKs
            - [ ] Verify custom code is preserved
            - [ ] Check examples still work
            
            **Note:** This is running in parallel with existing pipeline for testing.






