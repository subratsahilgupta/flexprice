# Cost Sheet PRD

### _Cost Sheet Integration with Billing System_

## 1. Overview

The Cost Sheet feature enables tracking and calculating input costs within the billing system. It provides a foundation for margin analysis by integrating with existing usage tracking and price calculation infrastructure. The system maintains a clear separation between revenue calculations and cost tracking while leveraging shared components.

## 2. Core Architecture

### 2.1 Database Schema

```sql
CREATE TABLE public.costsheet (
    id              VARCHAR(50) DEFAULT extensions.uuid_generate_v4() PRIMARY KEY,
    meter_id        VARCHAR(50) NOT NULL,
    price_id        VARCHAR(50) NOT NULL,
    tenant_id       VARCHAR(50) NOT NULL,
    environment_id  VARCHAR(50) NOT NULL,
    status          VARCHAR(20) DEFAULT 'published' NOT NULL,
    created_at      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    created_by      VARCHAR(50),
    updated_by      VARCHAR(50),
    FOREIGN KEY (meter_id)         REFERENCES meters(id),
    FOREIGN KEY (price_id)         REFERENCES prices(id),
    FOREIGN KEY (tenant_id)        REFERENCES tenants(id),
    FOREIGN KEY (environment_id)   REFERENCES environments(id)
);

-- Indexes for query optimization
CREATE INDEX idx_costsheet_tenant_env ON costsheet(tenant_id, environment_id);
CREATE UNIQUE INDEX idx_costsheet_meter_price ON costsheet(meter_id, price_id) WHERE status = 'published';
```

### 2.2 Domain Model

The cost sheet implementation follows a clean domain-driven design:

1. **Domain Model (`Costsheet`)**
   ```go
   type Costsheet struct {
       ID string
       MeterID string
       PriceID string
       types.BaseModel  // Embeds common fields
   }
   ```

2. **Repository Interface**
   ```go
   type Repository interface {
       Create(ctx context.Context, costsheet *Costsheet) error
       Get(ctx context.Context, id string) (*Costsheet, error)
       Update(ctx context.Context, costsheet *Costsheet) error
       Delete(ctx context.Context, id string) error
       List(ctx context.Context, filter *Filter) ([]*Costsheet, error)
       GetByMeterAndPrice(ctx context.Context, meterID, priceID string) (*Costsheet, error)
   }
   ```

3. **Filter Structure**
   ```go
   type Filter struct {
       QueryFilter *types.QueryFilter
       TimeRangeFilter *types.TimeRangeFilter
       Filters []*types.FilterCondition
       Sort []*types.SortCondition
       CostsheetIDs []string
       MeterIDs []string
       PriceIDs []string
       Status types.CostsheetStatus
       TenantID string
       EnvironmentID string
   }
   ```

### 2.3 Integration Points

1. **Meter Service**
   - Provides usage data via BulkGetUsageByMeter
   - Tracks consumption for cost calculation

2. **Price Service**
   - Handles cost calculations using existing price models
   - Supports flat rate, tiered, and package pricing

3. **Tenant & Environment Context**
   - Multi-tenancy support through tenant_id
   - Environment isolation (prod, staging, etc.)


### 2.4 Core Functions

1. **GetInputCostForMargin**
   - Fetches all published cost items
   - Gets usage data via BulkGetUsageByMeter
   - Calculates costs using price service
   - Returns aggregated input costs

2. **CalculateMargin**
   - Input: TotalInputCost, TotalRevenue
   - Calculates: (TotalRevenue - TotalCost) / TotalCost
   - Returns margin percentage

## 2.5. Service Interfaces

Service Layer
```go
type CostSheetService interface {
    GetInputCostForMargin(ctx context.Context, req *dto.CreateCostsheetRequest) (*dto.CostBreakdownResponse, error)
    CalculateMargin(totalCost, totalRevenue decimal.Decimal) decimal.Decimal
}

type PriceService interface {
    // Existing methods...
    
    // New methods for cost calculation
    CalculateCostSheetPrice(ctx context.Context, price *price.Price, quantity decimal.Decimal) decimal.Decimal
}
```

### 2.6 Status Management

The system supports three states for cost sheets:

```go
const (
    CostsheetStatusPublished CostsheetStatus = "published"
    CostsheetStatusDraft     CostsheetStatus = "draft"
    CostsheetStatusArchived  CostsheetStatus = "archived"
)
```


## 2.7 Cost Calculation Flow


<svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="-8 -8 593.796875 467.60003662109375" style="max-width: 593.796875px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-svg-1749529562038-tp0jz51sh"><style>#mermaid-svg-1749529562038-tp0jz51sh{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749529562038-tp0jz51sh .error-icon{fill:#bf616a;}#mermaid-svg-1749529562038-tp0jz51sh .error-text{fill:#bf616a;stroke:#bf616a;}#mermaid-svg-1749529562038-tp0jz51sh .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-1749529562038-tp0jz51sh .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-1749529562038-tp0jz51sh .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-1749529562038-tp0jz51sh .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-1749529562038-tp0jz51sh .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-1749529562038-tp0jz51sh .marker{fill:rgba(204, 204, 204, 0.87);stroke:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749529562038-tp0jz51sh .marker.cross{stroke:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749529562038-tp0jz51sh svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-1749529562038-tp0jz51sh .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749529562038-tp0jz51sh .cluster-label text{fill:#ffffff;}#mermaid-svg-1749529562038-tp0jz51sh .cluster-label span,#mermaid-svg-1749529562038-tp0jz51sh p{color:#ffffff;}#mermaid-svg-1749529562038-tp0jz51sh .label text,#mermaid-svg-1749529562038-tp0jz51sh span,#mermaid-svg-1749529562038-tp0jz51sh p{fill:rgba(204, 204, 204, 0.87);color:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749529562038-tp0jz51sh .node rect,#mermaid-svg-1749529562038-tp0jz51sh .node circle,#mermaid-svg-1749529562038-tp0jz51sh .node ellipse,#mermaid-svg-1749529562038-tp0jz51sh .node polygon,#mermaid-svg-1749529562038-tp0jz51sh .node path{fill:#1a1a1a;stroke:#2a2a2a;stroke-width:1px;}#mermaid-svg-1749529562038-tp0jz51sh .flowchart-label text{text-anchor:middle;}#mermaid-svg-1749529562038-tp0jz51sh .node .label{text-align:center;}#mermaid-svg-1749529562038-tp0jz51sh .node.clickable{cursor:pointer;}#mermaid-svg-1749529562038-tp0jz51sh .arrowheadPath{fill:#e5e5e5;}#mermaid-svg-1749529562038-tp0jz51sh .edgePath .path{stroke:rgba(204, 204, 204, 0.87);stroke-width:2.0px;}#mermaid-svg-1749529562038-tp0jz51sh .flowchart-link{stroke:rgba(204, 204, 204, 0.87);fill:none;}#mermaid-svg-1749529562038-tp0jz51sh .edgeLabel{background-color:#1a1a1a99;text-align:center;}#mermaid-svg-1749529562038-tp0jz51sh .edgeLabel rect{opacity:0.5;background-color:#1a1a1a99;fill:#1a1a1a99;}#mermaid-svg-1749529562038-tp0jz51sh .labelBkg{background-color:rgba(26, 26, 26, 0.5);}#mermaid-svg-1749529562038-tp0jz51sh .cluster rect{fill:rgba(64, 64, 64, 0.47);stroke:#30373a;stroke-width:1px;}#mermaid-svg-1749529562038-tp0jz51sh .cluster text{fill:#ffffff;}#mermaid-svg-1749529562038-tp0jz51sh .cluster span,#mermaid-svg-1749529562038-tp0jz51sh p{color:#ffffff;}#mermaid-svg-1749529562038-tp0jz51sh div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:#88c0d0;border:1px solid #30373a;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-1749529562038-tp0jz51sh .flowchartTitleText{text-anchor:middle;font-size:18px;fill:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749529562038-tp0jz51sh :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="6" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749529562038-tp0jz51sh_flowchart-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"/></marker><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749529562038-tp0jz51sh_flowchart-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749529562038-tp0jz51sh_flowchart-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749529562038-tp0jz51sh_flowchart-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart" id="mermaid-svg-1749529562038-tp0jz51sh_flowchart-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart" id="mermaid-svg-1749529562038-tp0jz51sh_flowchart-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><g class="root"><g class="clusters"/><g class="edgePaths"><path marker-end="url(#mermaid-svg-1749529562038-tp0jz51sh_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-B" id="L-A-B-0" d="M198.067,33.6L198.067,37.767C198.067,41.933,198.067,50.267,198.067,57.717C198.067,65.167,198.067,71.733,198.067,75.017L198.067,78.3"/><path marker-end="url(#mermaid-svg-1749529562038-tp0jz51sh_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-C1" id="L-B-C1-0" d="M248.18,117.2L260.608,121.367C273.037,125.533,297.894,133.867,310.323,141.317C322.752,148.767,322.752,155.333,322.752,158.617L322.752,161.9"/><path marker-end="url(#mermaid-svg-1749529562038-tp0jz51sh_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-C2" id="L-B-C2-0" d="M156.139,117.2L145.74,121.367C135.341,125.533,114.543,133.867,104.144,141.317C93.745,148.767,93.745,155.333,93.745,158.617L93.745,161.9"/><path marker-end="url(#mermaid-svg-1749529562038-tp0jz51sh_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-C2 LE-D" id="L-C2-D-0" d="M93.745,200.8L93.745,204.967C93.745,209.133,93.745,217.467,93.745,224.917C93.745,232.367,93.745,238.933,93.745,242.217L93.745,245.5"/><path marker-end="url(#mermaid-svg-1749529562038-tp0jz51sh_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-C1 LE-E" id="L-C1-E-0" d="M322.752,200.8L322.752,204.967C322.752,209.133,322.752,217.467,321.109,225.006C319.466,232.545,316.18,239.29,314.537,242.663L312.894,246.035"/><path marker-end="url(#mermaid-svg-1749529562038-tp0jz51sh_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-C2 LE-E" id="L-C2-E-0" d="M169.947,200.8L188.846,204.967C207.745,209.133,245.543,217.467,265.975,224.996C286.406,232.526,289.471,239.251,291.003,242.614L292.536,245.977"/><path marker-end="url(#mermaid-svg-1749529562038-tp0jz51sh_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-E LE-F" id="L-E-F-0" d="M302.389,284.4L302.389,288.567C302.389,292.733,302.389,301.067,302.389,308.517C302.389,315.967,302.389,322.533,302.389,325.817L302.389,329.1"/><path marker-end="url(#mermaid-svg-1749529562038-tp0jz51sh_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-F LE-G1" id="L-F-G1-0" d="M245.633,362.571L220.318,367.642C195.004,372.714,144.374,382.857,119.06,391.212C93.745,399.567,93.745,406.133,93.745,409.417L93.745,412.7"/><path marker-end="url(#mermaid-svg-1749529562038-tp0jz51sh_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-F LE-G2" id="L-F-G2-0" d="M302.389,368L302.389,372.167C302.389,376.333,302.389,384.667,302.389,392.117C302.389,399.567,302.389,406.133,302.389,409.417L302.389,412.7"/><path marker-end="url(#mermaid-svg-1749529562038-tp0jz51sh_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-F LE-G3" id="L-F-G3-0" d="M359.145,362.929L383.397,367.941C407.648,372.953,456.151,382.976,480.402,391.272C504.653,399.567,504.653,406.133,504.653,409.417L504.653,412.7"/></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(198.06719207763672, 16.80000114440918)" id="flowchart-A-73" class="node default default flowchart-label"><rect height="33.60000038146973" width="115.87501525878906" y="-16.800000190734863" x="-57.93750762939453" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-50.43750762939453, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="100.87501525878906"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Billing Service</span></div></foreignObject></g></g><g transform="translate(198.06719207763672, 100.40000343322754)" id="flowchart-B-74" class="node default default flowchart-label"><rect height="33.60000038146973" width="157.57501220703125" y="-16.800000190734863" x="-78.78750610351562" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-71.28750610351562, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="142.57501220703125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">CalculateAllCharges</span></div></foreignObject></g></g><g transform="translate(322.7515640258789, 184.0000057220459)" id="flowchart-C1-76" class="node default default flowchart-label"><rect height="33.60000038146973" width="177.30938720703125" y="-16.800000190734863" x="-88.65469360351562" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-81.15469360351562, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="162.30938720703125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">CalculateFixedCharges</span></div></foreignObject></g></g><g transform="translate(93.74531555175781, 184.0000057220459)" id="flowchart-C2-78" class="node default default flowchart-label"><rect height="33.60000038146973" width="180.703125" y="-16.800000190734863" x="-90.3515625" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-82.8515625, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="165.703125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">CalculateUsageCharges</span></div></foreignObject></g></g><g transform="translate(93.74531555175781, 267.60000801086426)" id="flowchart-D-80" class="node default default flowchart-label"><rect height="33.60000038146973" width="187.49063110351562" y="-16.800000190734863" x="-93.74531555175781" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-86.24531555175781, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="172.49063110351562"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">GetUsageBySubscription</span></div></foreignObject></g></g><g transform="translate(302.3890686035156, 267.60000801086426)" id="flowchart-E-83" class="node default default flowchart-label"><rect height="33.60000038146973" width="107.09062957763672" y="-16.800000190734863" x="-53.54531478881836" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-46.04531478881836, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="92.09062957763672"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Price Service</span></div></foreignObject></g></g><g transform="translate(302.3890686035156, 351.2000102996826)" id="flowchart-F-85" class="node default default flowchart-label"><rect height="33.60000038146973" width="113.51250457763672" y="-16.800000190734863" x="-56.75625228881836" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-49.25625228881836, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="98.51250457763672"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">CalculateCost</span></div></foreignObject></g></g><g transform="translate(93.74531555175781, 434.800012588501)" id="flowchart-G1-87" class="node default default flowchart-label"><rect height="33.60000038146973" width="159.046875" y="-16.800000190734863" x="-79.5234375" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-72.0234375, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="144.046875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Flat Fee Calculation</span></div></foreignObject></g></g><g transform="translate(302.3890686035156, 434.800012588501)" id="flowchart-G2-89" class="node default default flowchart-label"><rect height="33.60000038146973" width="158.24063110351562" y="-16.800000190734863" x="-79.12031555175781" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-71.62031555175781, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="143.24063110351562"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Package Calculation</span></div></foreignObject></g></g><g transform="translate(504.65313720703125, 434.800012588501)" id="flowchart-G3-91" class="node default default flowchart-label"><rect height="33.60000038146973" width="146.28750610351562" y="-16.800000190734863" x="-73.14375305175781" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-65.64375305175781, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="131.28750610351562"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Tiered Calculation</span></div></foreignObject></g></g></g></g></g></svg>


## 3. API Endpoints

### 3.1 Cost Sheet Management

```http
POST /api/v1/cost
{
    "meter_id": "string",
    "price_id": "string"
}

GET /api/v1/cost?tenant_id=string&environment_id=string&status=published

GET /api/v1/cost/{id}

PUT /api/v1/cost/{id}
{
    "status": "string"
}

DELETE /api/v1/cost/{id}
```

### 3.2 Cost Calculation

```http
GET /api/v1/cost/breakdown
{
    "start_time": "timestamp",
    "end_time": "timestamp"
}

Response:
{
    "total_cost": "decimal",
    "items": [
        {
            "meter_id": "string",
            "meter_name": "string",
            "usage": "decimal",
            "cost": "decimal"
        }
    ]
}
```

### 3.3 Dev ROI

```http
GET /api/v1/cost/roi
{
	"SubscriptionID": "string",
	"PeriodStart": "timestamp",
	"PeriodEnd": "timestamp",
	"MeterID": "string",
	"PriceID": "string"
}


## 4. Implementation Details

### 4.1 Core Components

1. **Cost Sheet Service**
   - Manages cost sheet lifecycle (CRUD operations)
   - Handles tenant and environment context
   - Validates meter and price associations

2. **Cost Calculation Engine**
   - Integrates with usage tracking
   - Applies price configurations
   - Aggregates costs across meters

### 4.2 Multi-tenancy & Environment Support

1. **Context Management**
   - Automatic tenant and environment extraction from context
   - Enforced isolation between tenants and environments

2. **Data Access**
   - Filtered queries based on tenant_id and environment_id
   - Unique constraints per tenant-environment combination

## 5. Security & Access Control

1. **Data Isolation**
   - Strict tenant and environment boundaries
   - No cross-tenant data access

2. **Status Management**
   - Published/Draft status tracking
   - Unique constraints only on published records







### _Visuals_
## _Overview function map_


<svg aria-roledescription="classDiagram" role="graphics-document document" viewBox="0 0 860.9609375 716" style="max-width: 860.9609375px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-svg-1749564052977-m773awpm2"><style>#mermaid-svg-1749564052977-m773awpm2{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749564052977-m773awpm2 .error-icon{fill:#bf616a;}#mermaid-svg-1749564052977-m773awpm2 .error-text{fill:#bf616a;stroke:#bf616a;}#mermaid-svg-1749564052977-m773awpm2 .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-1749564052977-m773awpm2 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-1749564052977-m773awpm2 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-1749564052977-m773awpm2 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-1749564052977-m773awpm2 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-1749564052977-m773awpm2 .marker{fill:rgba(204, 204, 204, 0.87);stroke:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749564052977-m773awpm2 .marker.cross{stroke:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749564052977-m773awpm2 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-1749564052977-m773awpm2 g.classGroup text{fill:#2a2a2a;stroke:none;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:10px;}#mermaid-svg-1749564052977-m773awpm2 g.classGroup text .title{font-weight:bolder;}#mermaid-svg-1749564052977-m773awpm2 .nodeLabel,#mermaid-svg-1749564052977-m773awpm2 .edgeLabel{color:#d8dee9;}#mermaid-svg-1749564052977-m773awpm2 .edgeLabel .label rect{fill:#1a1a1a;}#mermaid-svg-1749564052977-m773awpm2 .label text{fill:#d8dee9;}#mermaid-svg-1749564052977-m773awpm2 .edgeLabel .label span{background:#1a1a1a;}#mermaid-svg-1749564052977-m773awpm2 .classTitle{font-weight:bolder;}#mermaid-svg-1749564052977-m773awpm2 .node rect,#mermaid-svg-1749564052977-m773awpm2 .node circle,#mermaid-svg-1749564052977-m773awpm2 .node ellipse,#mermaid-svg-1749564052977-m773awpm2 .node polygon,#mermaid-svg-1749564052977-m773awpm2 .node path{fill:#1a1a1a;stroke:#2a2a2a;stroke-width:1px;}#mermaid-svg-1749564052977-m773awpm2 .divider{stroke:#2a2a2a;stroke-width:1;}#mermaid-svg-1749564052977-m773awpm2 g.clickable{cursor:pointer;}#mermaid-svg-1749564052977-m773awpm2 g.classGroup rect{fill:#1a1a1a;stroke:#2a2a2a;}#mermaid-svg-1749564052977-m773awpm2 g.classGroup line{stroke:#2a2a2a;stroke-width:1;}#mermaid-svg-1749564052977-m773awpm2 .classLabel .box{stroke:none;stroke-width:0;fill:#1a1a1a;opacity:0.5;}#mermaid-svg-1749564052977-m773awpm2 .classLabel .label{fill:#2a2a2a;font-size:10px;}#mermaid-svg-1749564052977-m773awpm2 .relation{stroke:rgba(204, 204, 204, 0.87);stroke-width:1;fill:none;}#mermaid-svg-1749564052977-m773awpm2 .dashed-line{stroke-dasharray:3;}#mermaid-svg-1749564052977-m773awpm2 .dotted-line{stroke-dasharray:1 2;}#mermaid-svg-1749564052977-m773awpm2 #compositionStart,#mermaid-svg-1749564052977-m773awpm2 .composition{fill:rgba(204, 204, 204, 0.87)!important;stroke:rgba(204, 204, 204, 0.87)!important;stroke-width:1;}#mermaid-svg-1749564052977-m773awpm2 #compositionEnd,#mermaid-svg-1749564052977-m773awpm2 .composition{fill:rgba(204, 204, 204, 0.87)!important;stroke:rgba(204, 204, 204, 0.87)!important;stroke-width:1;}#mermaid-svg-1749564052977-m773awpm2 #dependencyStart,#mermaid-svg-1749564052977-m773awpm2 .dependency{fill:rgba(204, 204, 204, 0.87)!important;stroke:rgba(204, 204, 204, 0.87)!important;stroke-width:1;}#mermaid-svg-1749564052977-m773awpm2 #dependencyStart,#mermaid-svg-1749564052977-m773awpm2 .dependency{fill:rgba(204, 204, 204, 0.87)!important;stroke:rgba(204, 204, 204, 0.87)!important;stroke-width:1;}#mermaid-svg-1749564052977-m773awpm2 #extensionStart,#mermaid-svg-1749564052977-m773awpm2 .extension{fill:transparent!important;stroke:rgba(204, 204, 204, 0.87)!important;stroke-width:1;}#mermaid-svg-1749564052977-m773awpm2 #extensionEnd,#mermaid-svg-1749564052977-m773awpm2 .extension{fill:transparent!important;stroke:rgba(204, 204, 204, 0.87)!important;stroke-width:1;}#mermaid-svg-1749564052977-m773awpm2 #aggregationStart,#mermaid-svg-1749564052977-m773awpm2 .aggregation{fill:transparent!important;stroke:rgba(204, 204, 204, 0.87)!important;stroke-width:1;}#mermaid-svg-1749564052977-m773awpm2 #aggregationEnd,#mermaid-svg-1749564052977-m773awpm2 .aggregation{fill:transparent!important;stroke:rgba(204, 204, 204, 0.87)!important;stroke-width:1;}#mermaid-svg-1749564052977-m773awpm2 #lollipopStart,#mermaid-svg-1749564052977-m773awpm2 .lollipop{fill:#1a1a1a!important;stroke:rgba(204, 204, 204, 0.87)!important;stroke-width:1;}#mermaid-svg-1749564052977-m773awpm2 #lollipopEnd,#mermaid-svg-1749564052977-m773awpm2 .lollipop{fill:#1a1a1a!important;stroke:rgba(204, 204, 204, 0.87)!important;stroke-width:1;}#mermaid-svg-1749564052977-m773awpm2 .edgeTerminals{font-size:11px;}#mermaid-svg-1749564052977-m773awpm2 .classTitleText{text-anchor:middle;font-size:18px;fill:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749564052977-m773awpm2 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="18" class="marker aggregation classDiagram" id="mermaid-svg-1749564052977-m773awpm2_classDiagram-aggregationStart"><path d="M 18,7 L9,13 L1,7 L9,1 Z"/></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="1" class="marker aggregation classDiagram" id="mermaid-svg-1749564052977-m773awpm2_classDiagram-aggregationEnd"><path d="M 18,7 L9,13 L1,7 L9,1 Z"/></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="18" class="marker extension classDiagram" id="mermaid-svg-1749564052977-m773awpm2_classDiagram-extensionStart"><path d="M 1,7 L18,13 V 1 Z"/></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="1" class="marker extension classDiagram" id="mermaid-svg-1749564052977-m773awpm2_classDiagram-extensionEnd"><path d="M 1,1 V 13 L18,7 Z"/></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="18" class="marker composition classDiagram" id="mermaid-svg-1749564052977-m773awpm2_classDiagram-compositionStart"><path d="M 18,7 L9,13 L1,7 L9,1 Z"/></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="1" class="marker composition classDiagram" id="mermaid-svg-1749564052977-m773awpm2_classDiagram-compositionEnd"><path d="M 18,7 L9,13 L1,7 L9,1 Z"/></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="6" class="marker dependency classDiagram" id="mermaid-svg-1749564052977-m773awpm2_classDiagram-dependencyStart"><path d="M 5,7 L9,13 L1,7 L9,1 Z"/></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="13" class="marker dependency classDiagram" id="mermaid-svg-1749564052977-m773awpm2_classDiagram-dependencyEnd"><path d="M 18,7 L9,13 L14,7 L9,1 Z"/></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="13" class="marker lollipop classDiagram" id="mermaid-svg-1749564052977-m773awpm2_classDiagram-lollipopStart"><circle r="6" cy="7" cx="7" fill="transparent" stroke="black"/></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="1" class="marker lollipop classDiagram" id="mermaid-svg-1749564052977-m773awpm2_classDiagram-lollipopEnd"><circle r="6" cy="7" cx="7" fill="transparent" stroke="black"/></marker></defs><g class="root"><g class="clusters"/><g class="edgePaths"><path marker-end="url(#mermaid-svg-1749564052977-m773awpm2_classDiagram-dependencyEnd)" style="fill:none" class="edge-pattern-solid relation" id="id1" d="M226.996,133L216.342,137.167C205.688,141.333,184.379,149.667,173.725,157C163.07,164.333,163.07,170.667,163.07,173.833L163.07,177"/><path marker-end="url(#mermaid-svg-1749564052977-m773awpm2_classDiagram-dependencyEnd)" style="fill:none" class="edge-pattern-solid relation" id="id2" d="M546.625,133L557.279,137.167C567.934,141.333,589.242,149.667,599.896,164.5C610.551,179.333,610.551,200.667,610.551,211.333L610.551,222"/><path marker-end="url(#mermaid-svg-1749564052977-m773awpm2_classDiagram-dependencyEnd)" style="fill:none" class="edge-pattern-solid relation" id="id3" d="M163.07,398L163.07,402.167C163.07,406.333,163.07,414.667,163.07,422C163.07,429.333,163.07,435.667,163.07,438.833L163.07,442"/></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(163.0703125, 578)" id="classId-costsheet-8" class="node default"><rect height="260" width="249.65625" y="-130" x="-124.828125" class="outer title-state"/><line y2="-99.5" y1="-99.5" x2="124.828125" x1="-124.828125" class="divider"/><line y2="96.5" y1="96.5" x2="124.828125" x1="-124.828125" class="divider"/><g class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"></span></div></foreignObject><foreignObject transform="translate( -54.109375, -122.5)" height="18.5" width="108.21875" class="classTitle"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">costsheet</span></div></foreignObject><foreignObject transform="translate( -117.328125, -88)" height="18.5" width="67.8515625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">+ID string</span></div></foreignObject><foreignObject transform="translate( -117.328125, -65.5)" height="18.5" width="109.21875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">+MeterID string</span></div></foreignObject><foreignObject transform="translate( -117.328125, -43)" height="18.5" width="103.453125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">+PriceID string</span></div></foreignObject><foreignObject transform="translate( -117.328125, -20.5)" height="18.5" width="97.59375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">+Status string</span></div></foreignObject><foreignObject transform="translate( -117.328125, 2)" height="18.5" width="116.109375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">+TenantID string</span></div></foreignObject><foreignObject transform="translate( -117.328125, 24.5)" height="18.5" width="158.203125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">+EnvironmentID string</span></div></foreignObject><foreignObject transform="translate( -117.328125, 47)" height="18.5" width="159.8828125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">+CreatedAt time.Time</span></div></foreignObject><foreignObject transform="translate( -117.328125, 69.5)" height="18.5" width="163.5703125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">+UpdatedAt time.Time</span></div></foreignObject><foreignObject transform="translate( -117.328125, 104)" height="18.5" width="234.65625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">+ToDTO() : *types.costsheet</span></div></foreignObject></g></g><g transform="translate(163.0703125, 290.5)" id="classId-Repository-9" class="node default"><rect height="215" width="310.140625" y="-107.5" x="-155.0703125" class="outer title-state"/><line y2="-54.5" y1="-54.5" x2="155.0703125" x1="-155.0703125" class="divider"/><line y2="-38.5" y1="-38.5" x2="155.0703125" x1="-155.0703125" class="divider"/><g class="label"><foreignObject transform="translate( -41.171875, -100)" height="18.5" width="82.34375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">«interface»</span></div></foreignObject><foreignObject transform="translate( -39.890625, -77.5)" height="18.5" width="79.78125" class="classTitle"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Repository</span></div></foreignObject><foreignObject transform="translate( -147.5703125, -31)" height="18.5" width="185.5078125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">+Create(ctx, item) : error</span></div></foreignObject><foreignObject transform="translate( -147.5703125, -8.5)" height="18.5" width="260.7890625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">+Get(ctx, id)(*costsheet, error)</span></div></foreignObject><foreignObject transform="translate( -147.5703125, 14)" height="18.5" width="295.140625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">+List(ctx, filter)([]*costsheet, error)</span></div></foreignObject><foreignObject transform="translate( -147.5703125, 36.5)" height="18.5" width="209.6484375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">+Count(ctx, filter)(int, error)</span></div></foreignObject><foreignObject transform="translate( -147.5703125, 59)" height="18.5" width="189.1953125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">+Update(ctx, item) : error</span></div></foreignObject><foreignObject transform="translate( -147.5703125, 81.5)" height="18.5" width="165.1328125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">+Delete(ctx, id) : error</span></div></foreignObject></g></g><g transform="translate(386.810546875, 70.5)" id="classId-CostSheetService-10" class="node default"><rect height="125" width="480.21875" y="-62.5" x="-240.109375" class="outer title-state"/><line y2="-9.5" y1="-9.5" x2="240.109375" x1="-240.109375" class="divider"/><line y2="6.5" y1="6.5" x2="240.109375" x1="-240.109375" class="divider"/><g class="label"><foreignObject transform="translate( -41.171875, -55)" height="18.5" width="82.34375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">«interface»</span></div></foreignObject><foreignObject transform="translate( -64.890625, -32.5)" height="18.5" width="129.78125" class="classTitle"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">CostSheetService</span></div></foreignObject><foreignObject transform="translate( -232.609375, 14)" height="18.5" width="465.21875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">+GetInputCostForMargin(ctx, req)(*GetInputCostResponse, error)</span></div></foreignObject><foreignObject transform="translate( -232.609375, 36.5)" height="18.5" width="440.9921875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">+CalculateMargin(totalCost, totalRevenue) : decimal.Decimal</span></div></foreignObject></g></g><g transform="translate(610.55078125, 290.5)" id="classId-PriceService-11" class="node default"><rect height="125" width="484.8203125" y="-62.5" x="-242.41015625" class="outer title-state"/><line y2="-9.5" y1="-9.5" x2="242.41015625" x1="-242.41015625" class="divider"/><line y2="6.5" y1="6.5" x2="242.41015625" x1="-242.41015625" class="divider"/><g class="label"><foreignObject transform="translate( -41.171875, -55)" height="18.5" width="82.34375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">«interface»</span></div></foreignObject><foreignObject transform="translate( -46.84375, -32.5)" height="18.5" width="93.6875" class="classTitle"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">PriceService</span></div></foreignObject><foreignObject transform="translate( -234.91015625, 14)" height="18.5" width="393.984375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">+CalculateCost(ctx, price, quantity) : decimal.Decimal</span></div></foreignObject><foreignObject transform="translate( -234.91015625, 36.5)" height="18.5" width="469.8203125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">+CalculateCostSheetPrice(ctx, price, quantity) : decimal.Decimal</span></div></foreignObject></g></g></g></g></g></svg>














## _Detailed Function map_

<svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="-8 -8 1907.125 862.5" style="max-width: 1907.125px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-svg-1749809589117-mejge5ucz"><style>#mermaid-svg-1749809589117-mejge5ucz{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749809589117-mejge5ucz .error-icon{fill:#bf616a;}#mermaid-svg-1749809589117-mejge5ucz .error-text{fill:#bf616a;stroke:#bf616a;}#mermaid-svg-1749809589117-mejge5ucz .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-1749809589117-mejge5ucz .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-1749809589117-mejge5ucz .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-1749809589117-mejge5ucz .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-1749809589117-mejge5ucz .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-1749809589117-mejge5ucz .marker{fill:rgba(204, 204, 204, 0.87);stroke:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749809589117-mejge5ucz .marker.cross{stroke:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749809589117-mejge5ucz svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-1749809589117-mejge5ucz .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749809589117-mejge5ucz .cluster-label text{fill:#ffffff;}#mermaid-svg-1749809589117-mejge5ucz .cluster-label span,#mermaid-svg-1749809589117-mejge5ucz p{color:#ffffff;}#mermaid-svg-1749809589117-mejge5ucz .label text,#mermaid-svg-1749809589117-mejge5ucz span,#mermaid-svg-1749809589117-mejge5ucz p{fill:rgba(204, 204, 204, 0.87);color:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749809589117-mejge5ucz .node rect,#mermaid-svg-1749809589117-mejge5ucz .node circle,#mermaid-svg-1749809589117-mejge5ucz .node ellipse,#mermaid-svg-1749809589117-mejge5ucz .node polygon,#mermaid-svg-1749809589117-mejge5ucz .node path{fill:#1a1a1a;stroke:#2a2a2a;stroke-width:1px;}#mermaid-svg-1749809589117-mejge5ucz .flowchart-label text{text-anchor:middle;}#mermaid-svg-1749809589117-mejge5ucz .node .label{text-align:center;}#mermaid-svg-1749809589117-mejge5ucz .node.clickable{cursor:pointer;}#mermaid-svg-1749809589117-mejge5ucz .arrowheadPath{fill:#e5e5e5;}#mermaid-svg-1749809589117-mejge5ucz .edgePath .path{stroke:rgba(204, 204, 204, 0.87);stroke-width:2.0px;}#mermaid-svg-1749809589117-mejge5ucz .flowchart-link{stroke:rgba(204, 204, 204, 0.87);fill:none;}#mermaid-svg-1749809589117-mejge5ucz .edgeLabel{background-color:#1a1a1a99;text-align:center;}#mermaid-svg-1749809589117-mejge5ucz .edgeLabel rect{opacity:0.5;background-color:#1a1a1a99;fill:#1a1a1a99;}#mermaid-svg-1749809589117-mejge5ucz .labelBkg{background-color:rgba(26, 26, 26, 0.5);}#mermaid-svg-1749809589117-mejge5ucz .cluster rect{fill:rgba(64, 64, 64, 0.47);stroke:#30373a;stroke-width:1px;}#mermaid-svg-1749809589117-mejge5ucz .cluster text{fill:#ffffff;}#mermaid-svg-1749809589117-mejge5ucz .cluster span,#mermaid-svg-1749809589117-mejge5ucz p{color:#ffffff;}#mermaid-svg-1749809589117-mejge5ucz div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:#88c0d0;border:1px solid #30373a;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-1749809589117-mejge5ucz .flowchartTitleText{text-anchor:middle;font-size:18px;fill:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749809589117-mejge5ucz :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="6" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"/></marker><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749809589117-mejge5ucz_flowchart-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749809589117-mejge5ucz_flowchart-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749809589117-mejge5ucz_flowchart-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart" id="mermaid-svg-1749809589117-mejge5ucz_flowchart-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart" id="mermaid-svg-1749809589117-mejge5ucz_flowchart-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><g class="root"><g class="clusters"><g id="subGraph5" class="cluster default flowchart-label"><rect height="102" width="528.10546875" y="285.5" x="263.0078125" ry="0" rx="0" style=""/><g transform="translate(465.697265625, 285.5)" class="cluster-label"><foreignObject height="18.5" width="122.7265625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">External Services</span></div></foreignObject></g></g><g id="subGraph4" class="cluster default flowchart-label"><rect height="167" width="784.5546875" y="679.5" x="899.17578125" ry="0" rx="0" style=""/><g transform="translate(1236.625, 679.5)" class="cluster-label"><foreignObject height="18.5" width="109.65625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Database Layer</span></div></foreignObject></g></g><g id="subGraph3" class="cluster default flowchart-label"><rect height="83.5" width="825.5" y="546" x="817.3515625" ry="0" rx="0" style=""/><g transform="translate(1170.53515625, 546)" class="cluster-label"><foreignObject height="18.5" width="119.1328125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Repository Layer</span></div></foreignObject></g></g><g id="subGraph2" class="cluster default flowchart-label"><rect height="210.5" width="1068.16796875" y="285.5" x="811.11328125" ry="0" rx="0" style=""/><g transform="translate(1296.419921875, 285.5)" class="cluster-label"><foreignObject height="18.5" width="97.5546875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Domain Layer</span></div></foreignObject></g></g><g id="subGraph1" class="cluster default flowchart-label"><rect height="83.5" width="1891.125" y="152" x="0" ry="0" rx="0" style=""/><g transform="translate(897.63671875, 152)" class="cluster-label"><foreignObject height="18.5" width="95.8515625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Service Layer</span></div></foreignObject></g></g><g id="subGraph0" class="cluster default flowchart-label"><rect height="102" width="1325.15625" y="0" x="40.712890625" ry="0" rx="0" style=""/><g transform="translate(669.802734375, 0)" class="cluster-label"><foreignObject height="18.5" width="66.9765625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">API Layer</span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A1 LE-S1" id="L-A1-S1-0" d="M149.623,77L149.623,81.167C149.623,85.333,149.623,93.667,149.623,102C149.623,110.333,149.623,118.667,149.623,127C149.623,135.333,149.623,143.667,203.993,153.502C258.362,163.337,367.101,174.674,421.47,180.343L475.84,186.012"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A2 LE-S1" id="L-A2-S1-0" d="M343.439,77L343.439,81.167C343.439,85.333,343.439,93.667,343.439,102C343.439,110.333,343.439,118.667,343.439,127C343.439,135.333,343.439,143.667,365.519,152.295C387.598,160.923,431.757,169.846,453.837,174.307L475.916,178.768"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A3 LE-S1" id="L-A3-S1-0" d="M550.061,77L550.061,81.167C550.061,85.333,550.061,93.667,550.061,102C550.061,110.333,550.061,118.667,550.061,127C550.061,135.333,550.061,143.667,550.061,151.117C550.061,158.567,550.061,165.133,550.061,168.417L550.061,171.7"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A4 LE-S1" id="L-A4-S1-0" d="M773.443,77L773.443,81.167C773.443,85.333,773.443,93.667,773.443,102C773.443,110.333,773.443,118.667,773.443,127C773.443,135.333,773.443,143.667,748.573,152.482C723.702,161.297,673.961,170.593,649.09,175.241L624.22,179.89"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A5 LE-S1" id="L-A5-S1-0" d="M1009.088,77L1009.088,81.167C1009.088,85.333,1009.088,93.667,1009.088,102C1009.088,110.333,1009.088,118.667,1009.088,127C1009.088,135.333,1009.088,143.667,944.955,153.666C880.821,163.666,752.555,175.333,688.421,181.166L624.288,186.999"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A6 LE-S2" id="L-A6-S2-0" d="M1244.467,77L1244.467,81.167C1244.467,85.333,1244.467,93.667,1244.467,102C1244.467,110.333,1244.467,118.667,1244.467,127C1244.467,135.333,1244.467,143.667,1244.467,151.117C1244.467,158.567,1244.467,165.133,1244.467,168.417L1244.467,171.7"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-S1 LE-D1" id="L-S1-D1-0" d="M619.01,205.456L648.504,210.463C677.997,215.471,736.985,225.485,766.479,234.659C795.973,243.833,795.973,252.167,833.247,260.5C870.522,268.833,945.072,277.167,982.346,286.158C1019.621,295.15,1019.621,304.8,1019.621,309.625L1019.621,314.45"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-S2 LE-D4" id="L-S2-D4-0" d="M1283.879,210.5L1293.683,214.667C1303.487,218.833,1323.095,227.167,1332.899,235.5C1342.703,243.833,1342.703,252.167,1342.703,260.5C1342.703,268.833,1342.703,277.167,1354.564,286.679C1366.425,296.191,1390.147,306.882,1402.008,312.227L1413.869,317.572"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-S3 LE-D4" id="L-S3-D4-0" d="M1460.939,210.5L1460.939,214.667C1460.939,218.833,1460.939,227.167,1460.939,235.5C1460.939,243.833,1460.939,252.167,1460.939,260.5C1460.939,268.833,1460.939,277.167,1460.459,286.163C1459.979,295.159,1459.018,304.817,1458.538,309.647L1458.058,314.476"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-S4 LE-D5" id="L-S4-D5-0" d="M1628.836,210.5L1628.836,214.667C1628.836,218.833,1628.836,227.167,1628.836,235.5C1628.836,243.833,1628.836,252.167,1628.836,260.5C1628.836,268.833,1628.836,277.167,1628.836,286.158C1628.836,295.15,1628.836,304.8,1628.836,309.625L1628.836,314.45"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-S5 LE-D2" id="L-S5-D2-0" d="M1793.738,210.5L1793.738,214.667C1793.738,218.833,1793.738,227.167,1793.738,235.5C1793.738,243.833,1793.738,252.167,1793.738,260.5C1793.738,268.833,1793.738,277.167,1793.738,286.158C1793.738,295.15,1793.738,304.8,1793.738,309.625L1793.738,314.45"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D1 LE-D3" id="L-D1-D3-0" d="M1019.621,353.25L1019.621,358.958C1019.621,364.667,1019.621,376.083,1019.621,385.958C1019.621,395.833,1019.621,404.167,1078.096,413.93C1136.571,423.692,1253.52,434.885,1311.995,440.481L1370.47,446.077"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D4 LE-D3" id="L-D4-D3-0" d="M1455.867,353.25L1455.867,358.958C1455.867,364.667,1455.867,376.083,1455.867,385.958C1455.867,395.833,1455.867,404.167,1455.867,411.617C1455.867,419.067,1455.867,425.633,1455.867,428.917L1455.867,432.2"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D3 LE-R1" id="L-D3-R1-0" d="M1501.85,471L1513.288,475.167C1524.727,479.333,1547.604,487.667,1559.042,496C1570.48,504.333,1570.48,512.667,1570.48,521C1570.48,529.333,1570.48,537.667,1570.48,545.117C1570.48,552.567,1570.48,559.133,1570.48,562.417L1570.48,565.7"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D3 LE-R2" id="L-D3-R2-0" d="M1456.237,471L1456.329,475.167C1456.421,479.333,1456.605,487.667,1456.697,496C1456.789,504.333,1456.789,512.667,1456.789,521C1456.789,529.333,1456.789,537.667,1456.789,545.117C1456.789,552.567,1456.789,559.133,1456.789,562.417L1456.789,565.7"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D3 LE-R3" id="L-D3-R3-0" d="M1409.885,471L1398.446,475.167C1387.008,479.333,1364.131,487.667,1352.692,496C1341.254,504.333,1341.254,512.667,1341.254,521C1341.254,529.333,1341.254,537.667,1341.254,545.117C1341.254,552.567,1341.254,559.133,1341.254,562.417L1341.254,565.7"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D3 LE-R4" id="L-D3-R4-0" d="M1375.746,468.145L1348.978,472.788C1322.21,477.43,1268.673,486.715,1241.905,495.524C1215.137,504.333,1215.137,512.667,1215.137,521C1215.137,529.333,1215.137,537.667,1215.137,545.117C1215.137,552.567,1215.137,559.133,1215.137,562.417L1215.137,565.7"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D3 LE-R5" id="L-D3-R5-0" d="M1375.746,463.706L1330.141,469.088C1284.536,474.471,1193.327,485.235,1147.722,494.784C1102.117,504.333,1102.117,512.667,1102.117,521C1102.117,529.333,1102.117,537.667,1102.117,545.117C1102.117,552.567,1102.117,559.133,1102.117,562.417L1102.117,565.7"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D3 LE-R6" id="L-D3-R6-0" d="M1375.746,460.724L1302.984,466.603C1230.223,472.483,1084.699,484.241,1011.938,494.287C939.176,504.333,939.176,512.667,939.176,521C939.176,529.333,939.176,537.667,939.176,545.117C939.176,552.567,939.176,559.133,939.176,562.417L939.176,565.7"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-R1 LE-DB1" id="L-R1-DB1-0" d="M1570.48,604.5L1570.48,608.667C1570.48,612.833,1570.48,621.167,1570.48,629.5C1570.48,637.833,1570.48,646.167,1570.48,654.5C1570.48,662.833,1570.48,671.167,1559.872,679.198C1549.264,687.229,1528.047,694.957,1517.438,698.822L1506.83,702.686"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-R2 LE-DB1" id="L-R2-DB1-0" d="M1456.789,604.5L1456.789,608.667C1456.789,612.833,1456.789,621.167,1456.789,629.5C1456.789,637.833,1456.789,646.167,1456.789,654.5C1456.789,662.833,1456.789,671.167,1456.717,678.617C1456.644,686.067,1456.499,692.634,1456.427,695.918L1456.354,699.201"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-R3 LE-DB1" id="L-R3-DB1-0" d="M1341.254,604.5L1341.254,608.667C1341.254,612.833,1341.254,621.167,1341.254,629.5C1341.254,637.833,1341.254,646.167,1341.254,654.5C1341.254,662.833,1341.254,671.167,1351.862,679.198C1362.471,687.229,1383.688,694.957,1394.296,698.822L1404.905,702.686"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-R4 LE-DB1" id="L-R4-DB1-0" d="M1215.137,604.5L1215.137,608.667C1215.137,612.833,1215.137,621.167,1215.137,629.5C1215.137,637.833,1215.137,646.167,1215.137,654.5C1215.137,662.833,1215.137,671.167,1243.949,680.33C1272.761,689.494,1330.385,699.487,1359.196,704.484L1388.008,709.481"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-R5 LE-DB1" id="L-R5-DB1-0" d="M1102.117,604.5L1102.117,608.667C1102.117,612.833,1102.117,621.167,1102.117,629.5C1102.117,637.833,1102.117,646.167,1102.117,654.5C1102.117,662.833,1102.117,671.167,1149.759,680.956C1197.4,690.745,1292.684,701.991,1340.325,707.614L1387.967,713.236"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-R6 LE-DB1" id="L-R6-DB1-0" d="M939.176,604.5L939.176,608.667C939.176,612.833,939.176,621.167,939.176,629.5C939.176,637.833,939.176,646.167,939.176,654.5C939.176,662.833,939.176,671.167,1013.971,681.377C1088.766,691.587,1238.357,703.675,1313.152,709.718L1387.948,715.762"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-DB1 LE-DB2" id="L-DB1-DB2-0" d="M1484.061,738L1491.074,742.167C1498.087,746.333,1512.114,754.667,1519.127,762.117C1526.141,769.567,1526.141,776.133,1526.141,779.417L1526.141,782.7"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-DB1 LE-DB3" id="L-DB1-DB3-0" d="M1413.909,738L1403.472,742.167C1393.034,746.333,1372.16,754.667,1361.722,762.117C1351.285,769.567,1351.285,776.133,1351.285,779.417L1351.285,782.7"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-DB1 LE-DB4" id="L-DB1-DB4-0" d="M1393.23,726.768L1324.677,732.806C1256.124,738.845,1119.017,750.923,1050.464,760.245C981.91,769.567,981.91,776.133,981.91,779.417L981.91,782.7"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-S2 LE-E1" id="L-S2-E1-0" d="M1176.784,210.5L1159.947,214.667C1143.11,218.833,1109.437,227.167,1092.6,235.5C1075.764,243.833,1075.764,252.167,1013.178,260.5C950.592,268.833,825.421,277.167,762.836,284.617C700.25,292.067,700.25,298.633,700.25,301.917L700.25,305.2"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-S2 LE-E2" id="L-S2-E2-0" d="M1148.803,208.849L1120.661,213.291C1092.52,217.733,1036.236,226.616,1008.095,235.225C979.953,243.833,979.953,252.167,904.732,260.5C829.512,268.833,679.07,277.167,603.85,284.617C528.629,292.067,528.629,298.633,528.629,301.917L528.629,305.2"/><path marker-end="url(#mermaid-svg-1749809589117-mejge5ucz_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-S1 LE-E3" id="L-S1-E3-0" d="M481.111,208.466L460,212.971C438.889,217.477,396.667,226.489,375.556,235.161C354.445,243.833,354.445,252.167,354.445,260.5C354.445,268.833,354.445,277.167,354.445,284.617C354.445,292.067,354.445,298.633,354.445,301.917L354.445,305.2"/></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(700.25, 336.5)" id="flowchart-E1-397" class="node default default flowchart-label"><rect height="52" width="111.7265625" y="-26" x="-55.86328125" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-48.36328125, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="96.7265625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Event Service<br />Usage Data</span></div></foreignObject></g></g><g transform="translate(528.62890625, 336.5)" id="flowchart-E2-398" class="node default default flowchart-label"><rect height="52" width="131.515625" y="-26" x="-65.7578125" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-58.2578125, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="116.515625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Price Service<br />Cost Calculation</span></div></foreignObject></g></g><g transform="translate(354.4453125, 336.5)" id="flowchart-E3-399" class="node default default flowchart-label"><rect height="52" width="112.875" y="-26" x="-56.4375" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-48.9375, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="97.875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Meter Service<br />Meter Info</span></div></foreignObject></g></g><g transform="translate(1455.8671875, 721.25)" id="flowchart-DB1-393" class="node default default flowchart-label"><rect height="33.5" width="125.2734375" y="-16.75" x="-62.63671875" ry="0" rx="0" style="fill:#f3e5f5;" class="basic label-container"/><g transform="translate(-55.13671875, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="110.2734375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">costsheet table</span></div></foreignObject></g></g><g transform="translate(1526.140625, 804.75)" id="flowchart-DB2-394" class="node default default flowchart-label"><rect height="33.5" width="69.0546875" y="-16.75" x="-34.52734375" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-27.02734375, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="54.0546875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Indexes</span></div></foreignObject></g></g><g transform="translate(1351.28515625, 804.75)" id="flowchart-DB3-395" class="node default default flowchart-label"><rect height="33.5" width="104.890625" y="-16.75" x="-52.4453125" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-44.9453125, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="89.890625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Foreign Keys</span></div></foreignObject></g></g><g transform="translate(981.91015625, 804.75)" id="flowchart-DB4-396" class="node default default flowchart-label"><rect height="33.5" width="95.46875" y="-16.75" x="-47.734375" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-40.234375, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="80.46875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Constraints</span></div></foreignObject></g></g><g transform="translate(1570.48046875, 587.75)" id="flowchart-R1-387" class="node default default flowchart-label"><rect height="33.5" width="74.7421875" y="-16.75" x="-37.37109375" ry="0" rx="0" style="fill:#fce4ec;" class="basic label-container"/><g transform="translate(-29.87109375, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="59.7421875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Create()</span></div></foreignObject></g></g><g transform="translate(1456.7890625, 587.75)" id="flowchart-R2-388" class="node default default flowchart-label"><rect height="33.5" width="52.640625" y="-16.75" x="-26.3203125" ry="0" rx="0" style="fill:#fce4ec;" class="basic label-container"/><g transform="translate(-18.8203125, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="37.640625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Get()</span></div></foreignObject></g></g><g transform="translate(1341.25390625, 587.75)" id="flowchart-R3-389" class="node default default flowchart-label"><rect height="33.5" width="78.4296875" y="-16.75" x="-39.21484375" ry="0" rx="0" style="fill:#fce4ec;" class="basic label-container"/><g transform="translate(-31.71484375, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="63.4296875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Update()</span></div></foreignObject></g></g><g transform="translate(1215.13671875, 587.75)" id="flowchart-R4-390" class="node default default flowchart-label"><rect height="33.5" width="73.8046875" y="-16.75" x="-36.90234375" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-29.40234375, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="58.8046875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Delete()</span></div></foreignObject></g></g><g transform="translate(1102.1171875, 587.75)" id="flowchart-R5-391" class="node default default flowchart-label"><rect height="33.5" width="52.234375" y="-16.75" x="-26.1171875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-18.6171875, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="37.234375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">List()</span></div></foreignObject></g></g><g transform="translate(939.17578125, 587.75)" id="flowchart-R6-392" class="node default default flowchart-label"><rect height="33.5" width="173.6484375" y="-16.75" x="-86.82421875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-79.32421875, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="158.6484375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">GetByMeterAndPrice()</span></div></foreignObject></g></g><g transform="translate(1019.62109375, 336.5)" id="flowchart-D1-382" class="node default default flowchart-label"><rect height="33.5" width="132.109375" y="-16.75" x="-66.0546875" ry="0" rx="0" style="fill:#fff3e0;" class="basic label-container"/><g transform="translate(-58.5546875, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="117.109375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Costsheet Model</span></div></foreignObject></g></g><g transform="translate(1793.73828125, 336.5)" id="flowchart-D2-383" class="node default default flowchart-label"><rect height="33.5" width="101.0859375" y="-16.75" x="-50.54296875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-43.04296875, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="86.0859375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Filter Model</span></div></foreignObject></g></g><g transform="translate(1455.8671875, 454.25)" id="flowchart-D3-384" class="node default default flowchart-label"><rect height="33.5" width="160.2421875" y="-16.75" x="-80.12109375" ry="0" rx="0" style="fill:#fff3e0;" class="basic label-container"/><g transform="translate(-72.62109375, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="145.2421875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Repository Interface</span></div></foreignObject></g></g><g transform="translate(1455.8671875, 336.5)" id="flowchart-D4-385" class="node default default flowchart-label"><rect height="33.5" width="116.28125" y="-16.75" x="-58.140625" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-50.640625, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="101.28125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Business Logic</span></div></foreignObject></g></g><g transform="translate(1628.8359375, 336.5)" id="flowchart-D5-386" class="node default default flowchart-label"><rect height="33.5" width="128.71875" y="-16.75" x="-64.359375" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-56.859375, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="113.71875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Validation Rules</span></div></foreignObject></g></g><g transform="translate(550.060546875, 193.75)" id="flowchart-S1-377" class="node default default flowchart-label"><rect height="33.5" width="137.8984375" y="-16.75" x="-68.94921875" ry="0" rx="0" style="fill:#e8f5e8;" class="basic label-container"/><g transform="translate(-61.44921875, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="122.8984375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">CostSheetService</span></div></foreignObject></g></g><g transform="translate(1244.466796875, 193.75)" id="flowchart-S2-378" class="node default default flowchart-label"><rect height="33.5" width="191.328125" y="-16.75" x="-95.6640625" ry="0" rx="0" style="fill:#e8f5e8;" class="basic label-container"/><g transform="translate(-88.1640625, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="176.328125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">GetInputCostForMargin()</span></div></foreignObject></g></g><g transform="translate(1460.939453125, 193.75)" id="flowchart-S3-379" class="node default default flowchart-label"><rect height="33.5" width="141.6171875" y="-16.75" x="-70.80859375" ry="0" rx="0" style="fill:#e8f5e8;" class="basic label-container"/><g transform="translate(-63.30859375, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="126.6171875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">CalculateMargin()</span></div></foreignObject></g></g><g transform="translate(1628.8359375, 193.75)" id="flowchart-S4-380" class="node default default flowchart-label"><rect height="33.5" width="84.96875" y="-16.75" x="-42.484375" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-34.984375, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="69.96875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Validate()</span></div></foreignObject></g></g><g transform="translate(1793.73828125, 193.75)" id="flowchart-S5-381" class="node default default flowchart-label"><rect height="33.5" width="124.7734375" y="-16.75" x="-62.38671875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-54.88671875, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="109.7734375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">ProcessFilters()</span></div></foreignObject></g></g><g transform="translate(149.623046875, 51)" id="flowchart-A1-371" class="node default default flowchart-label"><rect height="52" width="147.8203125" y="-26" x="-73.91015625" ry="0" rx="0" style="fill:#e3f2fd;" class="basic label-container"/><g transform="translate(-66.41015625, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="132.8203125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">POST /cost_sheets<br />CreateCostsheet</span></div></foreignObject></g></g><g transform="translate(343.439453125, 51)" id="flowchart-A2-372" class="node default default flowchart-label"><rect height="52" width="139.8125" y="-26" x="-69.90625" ry="0" rx="0" style="fill:#e3f2fd;" class="basic label-container"/><g transform="translate(-62.40625, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="124.8125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">GET /cost_sheets<br />ListCostsheets</span></div></foreignObject></g></g><g transform="translate(550.060546875, 51)" id="flowchart-A3-373" class="node default default flowchart-label"><rect height="52" width="173.4296875" y="-26" x="-86.71484375" ry="0" rx="0" style="fill:#e3f2fd;" class="basic label-container"/><g transform="translate(-79.21484375, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="158.4296875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">GET /cost_sheets/{id}<br />GetCostsheet</span></div></foreignObject></g></g><g transform="translate(773.443359375, 51)" id="flowchart-A4-374" class="node default default flowchart-label"><rect height="52" width="173.3359375" y="-26" x="-86.66796875" ry="0" rx="0" style="fill:#e3f2fd;" class="basic label-container"/><g transform="translate(-79.16796875, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="158.3359375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">PUT /cost_sheets/{id}<br />UpdateCostsheet</span></div></foreignObject></g></g><g transform="translate(1009.087890625, 51)" id="flowchart-A5-375" class="node default default flowchart-label"><rect height="52" width="197.953125" y="-26" x="-98.9765625" ry="0" rx="0" style="fill:#e3f2fd;" class="basic label-container"/><g transform="translate(-91.4765625, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="182.953125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">DELETE /cost_sheets/{id}<br />DeleteCostsheet</span></div></foreignObject></g></g><g transform="translate(1244.466796875, 51)" id="flowchart-A6-376" class="node default default flowchart-label"><rect height="52" width="172.8046875" y="-26" x="-86.40234375" ry="0" rx="0" style="fill:#e3f2fd;" class="basic label-container"/><g transform="translate(-78.90234375, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="157.8046875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">GET /cost_breakdown<br />GetCostBreakdown</span></div></foreignObject></g></g></g></g></g></svg>



## _costsheet Feature Overview_

<svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="-7.5 -8 1564.228515625 678.5" style="max-width: 1564.228515625px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-svg-1749809604299-ia9l5o89k"><style>#mermaid-svg-1749809604299-ia9l5o89k{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749809604299-ia9l5o89k .error-icon{fill:#bf616a;}#mermaid-svg-1749809604299-ia9l5o89k .error-text{fill:#bf616a;stroke:#bf616a;}#mermaid-svg-1749809604299-ia9l5o89k .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-1749809604299-ia9l5o89k .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-1749809604299-ia9l5o89k .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-1749809604299-ia9l5o89k .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-1749809604299-ia9l5o89k .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-1749809604299-ia9l5o89k .marker{fill:rgba(204, 204, 204, 0.87);stroke:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749809604299-ia9l5o89k .marker.cross{stroke:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749809604299-ia9l5o89k svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-1749809604299-ia9l5o89k .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749809604299-ia9l5o89k .cluster-label text{fill:#ffffff;}#mermaid-svg-1749809604299-ia9l5o89k .cluster-label span,#mermaid-svg-1749809604299-ia9l5o89k p{color:#ffffff;}#mermaid-svg-1749809604299-ia9l5o89k .label text,#mermaid-svg-1749809604299-ia9l5o89k span,#mermaid-svg-1749809604299-ia9l5o89k p{fill:rgba(204, 204, 204, 0.87);color:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749809604299-ia9l5o89k .node rect,#mermaid-svg-1749809604299-ia9l5o89k .node circle,#mermaid-svg-1749809604299-ia9l5o89k .node ellipse,#mermaid-svg-1749809604299-ia9l5o89k .node polygon,#mermaid-svg-1749809604299-ia9l5o89k .node path{fill:#1a1a1a;stroke:#2a2a2a;stroke-width:1px;}#mermaid-svg-1749809604299-ia9l5o89k .flowchart-label text{text-anchor:middle;}#mermaid-svg-1749809604299-ia9l5o89k .node .label{text-align:center;}#mermaid-svg-1749809604299-ia9l5o89k .node.clickable{cursor:pointer;}#mermaid-svg-1749809604299-ia9l5o89k .arrowheadPath{fill:#e5e5e5;}#mermaid-svg-1749809604299-ia9l5o89k .edgePath .path{stroke:rgba(204, 204, 204, 0.87);stroke-width:2.0px;}#mermaid-svg-1749809604299-ia9l5o89k .flowchart-link{stroke:rgba(204, 204, 204, 0.87);fill:none;}#mermaid-svg-1749809604299-ia9l5o89k .edgeLabel{background-color:#1a1a1a99;text-align:center;}#mermaid-svg-1749809604299-ia9l5o89k .edgeLabel rect{opacity:0.5;background-color:#1a1a1a99;fill:#1a1a1a99;}#mermaid-svg-1749809604299-ia9l5o89k .labelBkg{background-color:rgba(26, 26, 26, 0.5);}#mermaid-svg-1749809604299-ia9l5o89k .cluster rect{fill:rgba(64, 64, 64, 0.47);stroke:#30373a;stroke-width:1px;}#mermaid-svg-1749809604299-ia9l5o89k .cluster text{fill:#ffffff;}#mermaid-svg-1749809604299-ia9l5o89k .cluster span,#mermaid-svg-1749809604299-ia9l5o89k p{color:#ffffff;}#mermaid-svg-1749809604299-ia9l5o89k div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:#88c0d0;border:1px solid #30373a;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-1749809604299-ia9l5o89k .flowchartTitleText{text-anchor:middle;font-size:18px;fill:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749809604299-ia9l5o89k :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="6" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749809604299-ia9l5o89k_flowchart-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"/></marker><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749809604299-ia9l5o89k_flowchart-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749809604299-ia9l5o89k_flowchart-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749809604299-ia9l5o89k_flowchart-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart" id="mermaid-svg-1749809604299-ia9l5o89k_flowchart-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart" id="mermaid-svg-1749809604299-ia9l5o89k_flowchart-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><g class="root"><g class="clusters"/><g class="edgePaths"/><g class="edgeLabels"/><g class="nodes"><g transform="translate(-7.5, -8)" class="root"><g class="clusters"><g id="subGraph4" class="cluster default flowchart-label"><rect height="662.5" width="1548.228515625" y="8" x="8" ry="0" rx="0" style=""/><g transform="translate(681.2197265625, 8)" class="cluster-label"><foreignObject height="18.5" width="201.7890625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Costsheet Feature Overview</span></div></foreignObject></g></g><g id="subGraph0" class="cluster default flowchart-label"><rect height="460.5" width="442.515625" y="33" x="28" ry="0" rx="0" style=""/><g transform="translate(203.1328125, 33)" class="cluster-label"><foreignObject height="18.5" width="92.25"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Core Entities</span></div></foreignObject></g></g><g id="subGraph1" class="cluster default flowchart-label"><rect height="241" width="778.330078125" y="252.5" x="490.515625" ry="0" rx="0" style=""/><g transform="translate(825.7275390625, 252.5)" class="cluster-label"><foreignObject height="18.5" width="107.90625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Key Operations</span></div></foreignObject></g></g><g id="subGraph2" class="cluster default flowchart-label"><rect height="393" width="247.3828125" y="252.5" x="1288.845703125" ry="0" rx="0" style=""/><g transform="translate(1342.744140625, 252.5)" class="cluster-label"><foreignObject height="18.5" width="139.5859375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Status Management</span></div></foreignObject></g></g><g id="subGraph3" class="cluster default flowchart-label"><rect height="102" width="752.2890625" y="543.5" x="471.220703125" ry="0" rx="0" style=""/><g transform="translate(783.935546875, 543.5)" class="cluster-label"><foreignObject height="18.5" width="126.859375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Integration Points</span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid-svg-1749809604299-ia9l5o89k_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-CS LE-M" id="L-CS-M-0" d="M226.348,173.169L212.335,182.224C198.323,191.279,170.298,209.39,156.286,222.611C142.273,235.833,142.273,244.167,142.273,251.617C142.273,259.067,142.273,265.633,142.273,268.917L142.273,272.2"/><path marker-end="url(#mermaid-svg-1749809604299-ia9l5o89k_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-CS LE-P" id="L-CS-P-0" d="M336.812,202.5L339.353,206.667C341.893,210.833,346.974,219.167,349.514,227.5C352.055,235.833,352.055,244.167,352.055,251.617C352.055,259.067,352.055,265.633,352.055,268.917L352.055,272.2"/><path marker-end="url(#mermaid-svg-1749809604299-ia9l5o89k_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-P LE-PL" id="L-P-PL-0" d="M352.055,348L352.055,352.167C352.055,356.333,352.055,364.667,352.055,372.117C352.055,379.567,352.055,386.133,352.055,389.417L352.055,392.7"/><path marker-end="url(#mermaid-svg-1749809604299-ia9l5o89k_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-CS LE-O1" id="L-CS-O1-0" d="M351.671,202.5L355.068,206.667C358.465,210.833,365.26,219.167,368.657,227.5C372.055,235.833,372.055,244.167,398.442,254.989C424.829,265.811,477.603,279.121,503.99,285.777L530.377,292.432"/><path marker-end="url(#mermaid-svg-1749809604299-ia9l5o89k_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-CS LE-O2" id="L-CS-O2-0" d="M359.176,190.586L365.948,196.738C372.72,202.891,386.264,215.195,393.036,225.514C399.809,235.833,399.809,244.167,473.353,257.04C546.897,269.913,693.985,287.325,767.529,296.032L841.073,304.738"/><path marker-end="url(#mermaid-svg-1749809604299-ia9l5o89k_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-O2 LE-O3" id="L-O2-O3-0" d="M846.336,329.214L818.672,336.512C791.008,343.81,735.68,358.405,708.016,370.527C680.352,382.65,680.352,392.3,680.352,397.125L680.352,401.95"/><path marker-end="url(#mermaid-svg-1749809604299-ia9l5o89k_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-CS LE-O4" id="L-CS-O4-0" d="M359.176,181.088L369.281,188.823C379.387,196.558,399.598,212.029,409.703,223.931C419.809,235.833,419.809,244.167,524.671,257.057C629.534,269.947,839.26,287.394,944.123,296.118L1048.986,304.841"/><path marker-end="url(#mermaid-svg-1749809604299-ia9l5o89k_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-CS LE-ST1" id="L-CS-ST1-0" d="M359.176,174.173L372.615,183.061C386.053,191.949,412.931,209.724,426.37,222.779C439.809,235.833,439.809,244.167,587.731,257.496C735.654,270.824,1031.499,289.149,1179.422,298.311L1327.345,307.473"/><path marker-end="url(#mermaid-svg-1749809604299-ia9l5o89k_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-ST1 LE-ST2" id="L-ST1-ST2-0" d="M1412.537,338.75L1412.537,344.458C1412.537,350.167,1412.537,361.583,1412.537,372.117C1412.537,382.65,1412.537,392.3,1412.537,397.125L1412.537,401.95"/><path marker-end="url(#mermaid-svg-1749809604299-ia9l5o89k_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-ST2 LE-ST3" id="L-ST2-ST3-0" d="M1412.537,459.25L1412.537,464.958C1412.537,470.667,1412.537,482.083,1412.537,491.958C1412.537,501.833,1412.537,510.167,1412.537,518.5C1412.537,526.833,1412.537,535.167,1412.537,542.617C1412.537,550.067,1412.537,556.633,1412.537,559.917L1412.537,563.2"/><path marker-end="url(#mermaid-svg-1749809604299-ia9l5o89k_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-O2 LE-I1" id="L-O2-I1-0" d="M923.035,338.75L926.172,344.458C929.308,350.167,935.581,361.583,938.717,377.333C941.854,393.083,941.854,413.167,941.854,433.25C941.854,453.333,941.854,473.417,941.854,487.625C941.854,501.833,941.854,510.167,941.854,518.5C941.854,526.833,941.854,535.167,941.854,542.617C941.854,550.067,941.854,556.633,941.854,559.917L941.854,563.2"/><path marker-end="url(#mermaid-svg-1749809604299-ia9l5o89k_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-O2 LE-I2" id="L-O2-I2-0" d="M971.164,330.514L996.043,337.595C1020.923,344.676,1070.681,358.838,1095.56,375.961C1120.439,393.083,1120.439,413.167,1120.439,433.25C1120.439,453.333,1120.439,473.417,1120.439,487.625C1120.439,501.833,1120.439,510.167,1120.439,518.5C1120.439,526.833,1120.439,535.167,1120.439,542.617C1120.439,550.067,1120.439,556.633,1120.439,559.917L1120.439,563.2"/><path marker-end="url(#mermaid-svg-1749809604299-ia9l5o89k_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-O3 LE-I3" id="L-O3-I3-0" d="M639.882,459.25L630.997,464.958C622.112,470.667,604.342,482.083,595.457,491.958C586.572,501.833,586.572,510.167,586.572,518.5C586.572,526.833,586.572,535.167,586.572,542.617C586.572,550.067,586.572,556.633,586.572,559.917L586.572,563.2"/><path marker-end="url(#mermaid-svg-1749809604299-ia9l5o89k_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-O3 LE-I4" id="L-O3-I4-0" d="M720.821,459.25L729.706,464.958C738.591,470.667,756.361,482.083,765.246,491.958C774.131,501.833,774.131,510.167,774.131,518.5C774.131,526.833,774.131,535.167,774.131,542.617C774.131,550.067,774.131,556.633,774.131,559.917L774.131,563.2"/></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(292.76171875, 130.25)" id="flowchart-CS-603" class="node default default flowchart-label"><rect height="144.5" width="132.828125" y="-72.25" x="-66.4140625" ry="0" rx="0" style="fill:#e1f5fe;" class="basic label-container"/><g transform="translate(-58.9140625, -64.75)" style="" class="label"><rect/><foreignObject height="129.5" width="117.828125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Costsheet<br />• ID<br />• MeterID<br />• PriceID<br />• Status<br />• TenantID<br />• EnvironmentID</span></div></foreignObject></g></g><g transform="translate(142.2734375, 312.75)" id="flowchart-M-604" class="node default default flowchart-label"><rect height="70.5" width="158.546875" y="-35.25" x="-79.2734375" ry="0" rx="0" style="fill:#e8f5e8;" class="basic label-container"/><g transform="translate(-71.7734375, -27.75)" style="" class="label"><rect/><foreignObject height="55.5" width="143.546875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Meter<br />• Tracks Usage<br />• Consumption Data</span></div></foreignObject></g></g><g transform="translate(352.0546875, 312.75)" id="flowchart-P-605" class="node default default flowchart-label"><rect height="70.5" width="161.015625" y="-35.25" x="-80.5078125" ry="0" rx="0" style="fill:#fff3e0;" class="basic label-container"/><g transform="translate(-73.0078125, -27.75)" style="" class="label"><rect/><foreignObject height="55.5" width="146.015625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Price<br />• Cost Configuration<br />• Calculation Rules</span></div></foreignObject></g></g><g transform="translate(352.0546875, 433.25)" id="flowchart-PL-606" class="node default default flowchart-label"><rect height="70.5" width="144.375" y="-35.25" x="-72.1875" ry="0" rx="0" style="fill:#f3e5f5;" class="basic label-container"/><g transform="translate(-64.6875, -27.75)" style="" class="label"><rect/><foreignObject height="55.5" width="129.375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Plan<br />• Billing Structure<br />• Price Groups</span></div></foreignObject></g></g><g transform="translate(610.93359375, 312.75)" id="flowchart-O1-607" class="node default default flowchart-label"><rect height="52" width="150.8359375" y="-26" x="-75.41796875" ry="0" rx="0" style="fill:#e0f2f1;" class="basic label-container"/><g transform="translate(-67.91796875, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="135.8359375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Create Costsheet<br />Link Meter to Price</span></div></foreignObject></g></g><g transform="translate(908.75, 312.75)" id="flowchart-O2-608" class="node default default flowchart-label"><rect height="52" width="124.828125" y="-26" x="-62.4140625" ry="0" rx="0" style="fill:#fff8e1;" class="basic label-container"/><g transform="translate(-54.9140625, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="109.828125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Calculate Costs<br />Usage × Price</span></div></foreignObject></g></g><g transform="translate(680.3515625, 433.25)" id="flowchart-O3-609" class="node default default flowchart-label"><rect height="52" width="182.4140625" y="-26" x="-91.20703125" ry="0" rx="0" style="fill:#ffebee;" class="basic label-container"/><g transform="translate(-83.70703125, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="167.4140625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Margin Analysis<br />(Revenue - Cost) / Cost</span></div></foreignObject></g></g><g transform="translate(1144.056640625, 312.75)" id="flowchart-O4-610" class="node default default flowchart-label"><rect height="52" width="179.578125" y="-26" x="-89.7890625" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-82.2890625, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="164.578125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Multi-tenant Support<br />Isolated by Tenant/Env</span></div></foreignObject></g></g><g transform="translate(1412.537109375, 312.75)" id="flowchart-ST1-611" class="node default default flowchart-label"><rect height="52" width="159.8046875" y="-26" x="-79.90234375" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-72.40234375, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="144.8046875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Draft<br />Under Configuration</span></div></foreignObject></g></g><g transform="translate(1412.537109375, 433.25)" id="flowchart-ST2-612" class="node default default flowchart-label"><rect height="52" width="177.3828125" y="-26" x="-88.69140625" ry="0" rx="0" style="fill:#e8f5e8;" class="basic label-container"/><g transform="translate(-81.19140625, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="162.3828125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Published<br />Active for Calculations</span></div></foreignObject></g></g><g transform="translate(1412.537109375, 594.5)" id="flowchart-ST3-613" class="node default default flowchart-label"><rect height="52" width="160.453125" y="-26" x="-80.2265625" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-72.7265625, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="145.453125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Archived<br />Historical Reference</span></div></foreignObject></g></g><g transform="translate(941.853515625, 594.5)" id="flowchart-I1-614" class="node default default flowchart-label"><rect height="52" width="121.03125" y="-26" x="-60.515625" ry="0" rx="0" style="fill:#f1f8e9;" class="basic label-container"/><g transform="translate(-53.015625, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="106.03125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Usage Tracking<br />Event Service</span></div></foreignObject></g></g><g transform="translate(1120.439453125, 594.5)" id="flowchart-I2-615" class="node default default flowchart-label"><rect height="52" width="136.140625" y="-26" x="-68.0703125" ry="0" rx="0" style="fill:#e8eaf6;" class="basic label-container"/><g transform="translate(-60.5703125, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="121.140625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Price Calculation<br />Price Service</span></div></foreignObject></g></g><g transform="translate(586.572265625, 594.5)" id="flowchart-I3-616" class="node default default flowchart-label"><rect height="52" width="160.703125" y="-26" x="-80.3515625" ry="0" rx="0" style="fill:#fce4ec;" class="basic label-container"/><g transform="translate(-72.8515625, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="145.703125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Billing System<br />Revenue Calculation</span></div></foreignObject></g></g><g transform="translate(774.130859375, 594.5)" id="flowchart-I4-617" class="node default default flowchart-label"><rect height="52" width="114.4140625" y="-26" x="-57.20703125" ry="0" rx="0" style="fill:#f0f4c3;" class="basic label-container"/><g transform="translate(-49.70703125, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="99.4140625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Reporting<br />Cost Analytics</span></div></foreignObject></g></g></g></g></g></g></g></svg>






## _Interaction Between Layers_

<svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="-8 -8 1676.216796875 1184" style="max-width: 1676.216796875px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-svg-1749809626743-9t2psmgqr"><style>#mermaid-svg-1749809626743-9t2psmgqr{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749809626743-9t2psmgqr .error-icon{fill:#bf616a;}#mermaid-svg-1749809626743-9t2psmgqr .error-text{fill:#bf616a;stroke:#bf616a;}#mermaid-svg-1749809626743-9t2psmgqr .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-1749809626743-9t2psmgqr .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-1749809626743-9t2psmgqr .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-1749809626743-9t2psmgqr .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-1749809626743-9t2psmgqr .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-1749809626743-9t2psmgqr .marker{fill:rgba(204, 204, 204, 0.87);stroke:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749809626743-9t2psmgqr .marker.cross{stroke:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749809626743-9t2psmgqr svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-1749809626743-9t2psmgqr .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749809626743-9t2psmgqr .cluster-label text{fill:#ffffff;}#mermaid-svg-1749809626743-9t2psmgqr .cluster-label span,#mermaid-svg-1749809626743-9t2psmgqr p{color:#ffffff;}#mermaid-svg-1749809626743-9t2psmgqr .label text,#mermaid-svg-1749809626743-9t2psmgqr span,#mermaid-svg-1749809626743-9t2psmgqr p{fill:rgba(204, 204, 204, 0.87);color:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749809626743-9t2psmgqr .node rect,#mermaid-svg-1749809626743-9t2psmgqr .node circle,#mermaid-svg-1749809626743-9t2psmgqr .node ellipse,#mermaid-svg-1749809626743-9t2psmgqr .node polygon,#mermaid-svg-1749809626743-9t2psmgqr .node path{fill:#1a1a1a;stroke:#2a2a2a;stroke-width:1px;}#mermaid-svg-1749809626743-9t2psmgqr .flowchart-label text{text-anchor:middle;}#mermaid-svg-1749809626743-9t2psmgqr .node .label{text-align:center;}#mermaid-svg-1749809626743-9t2psmgqr .node.clickable{cursor:pointer;}#mermaid-svg-1749809626743-9t2psmgqr .arrowheadPath{fill:#e5e5e5;}#mermaid-svg-1749809626743-9t2psmgqr .edgePath .path{stroke:rgba(204, 204, 204, 0.87);stroke-width:2.0px;}#mermaid-svg-1749809626743-9t2psmgqr .flowchart-link{stroke:rgba(204, 204, 204, 0.87);fill:none;}#mermaid-svg-1749809626743-9t2psmgqr .edgeLabel{background-color:#1a1a1a99;text-align:center;}#mermaid-svg-1749809626743-9t2psmgqr .edgeLabel rect{opacity:0.5;background-color:#1a1a1a99;fill:#1a1a1a99;}#mermaid-svg-1749809626743-9t2psmgqr .labelBkg{background-color:rgba(26, 26, 26, 0.5);}#mermaid-svg-1749809626743-9t2psmgqr .cluster rect{fill:rgba(64, 64, 64, 0.47);stroke:#30373a;stroke-width:1px;}#mermaid-svg-1749809626743-9t2psmgqr .cluster text{fill:#ffffff;}#mermaid-svg-1749809626743-9t2psmgqr .cluster span,#mermaid-svg-1749809626743-9t2psmgqr p{color:#ffffff;}#mermaid-svg-1749809626743-9t2psmgqr div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:#88c0d0;border:1px solid #30373a;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-1749809626743-9t2psmgqr .flowchartTitleText{text-anchor:middle;font-size:18px;fill:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749809626743-9t2psmgqr :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="6" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"/></marker><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749809626743-9t2psmgqr_flowchart-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749809626743-9t2psmgqr_flowchart-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart" id="mermaid-svg-1749809626743-9t2psmgqr_flowchart-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart" id="mermaid-svg-1749809626743-9t2psmgqr_flowchart-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><g class="root"><g class="clusters"><g id="subGraph6" class="cluster default flowchart-label"><rect height="102" width="853.671875" y="787" x="0" ry="0" rx="0" style=""/><g transform="translate(366.109375, 787)" class="cluster-label"><foreignObject height="18.5" width="121.453125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">External Systems</span></div></foreignObject></g></g><g id="subGraph5" class="cluster default flowchart-label"><rect height="229" width="604.34375" y="939" x="32.775390625" ry="0" rx="0" style=""/><g transform="translate(280.119140625, 939)" class="cluster-label"><foreignObject height="18.5" width="109.65625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Database Layer</span></div></foreignObject></g></g><g id="subGraph4" class="cluster default flowchart-label"><rect height="254" width="578.572265625" y="787" x="959.203125" ry="0" rx="0" style=""/><g transform="translate(1188.9228515625, 787)" class="cluster-label"><foreignObject height="18.5" width="119.1328125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Repository Layer</span></div></foreignObject></g></g><g id="subGraph3" class="cluster default flowchart-label"><rect height="102" width="790.6484375" y="635" x="869.568359375" ry="0" rx="0" style=""/><g transform="translate(1216.115234375, 635)" class="cluster-label"><foreignObject height="18.5" width="97.5546875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Domain Layer</span></div></foreignObject></g></g><g id="subGraph2" class="cluster default flowchart-label"><rect height="229" width="847.220703125" y="508" x="2.34765625" ry="0" rx="0" style=""/><g transform="translate(378.0322265625, 508)" class="cluster-label"><foreignObject height="18.5" width="95.8515625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Service Layer</span></div></foreignObject></g></g><g id="subGraph1" class="cluster default flowchart-label"><rect height="306" width="240.5859375" y="152" x="618.0859375" ry="0" rx="0" style=""/><g transform="translate(704.890625, 152)" class="cluster-label"><foreignObject height="18.5" width="66.9765625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">API Layer</span></div></foreignObject></g></g><g id="subGraph0" class="cluster default flowchart-label"><rect height="102" width="185.0390625" y="0" x="645.859375" ry="0" rx="0" style=""/><g transform="translate(694.96484375, 0)" class="cluster-label"><foreignObject height="18.5" width="86.828125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Client Layer</span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-CL LE-AL1" id="L-CL-AL1-0" d="M738.379,77L738.379,81.167C738.379,85.333,738.379,93.667,738.379,102C738.379,110.333,738.379,118.667,738.379,127C738.379,135.333,738.379,143.667,738.379,151.117C738.379,158.567,738.379,165.133,738.379,168.417L738.379,171.7"/><path marker-end="url(#mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-AL1 LE-AL2" id="L-AL1-AL2-0" d="M738.379,229L738.379,233.167C738.379,237.333,738.379,245.667,738.379,253.117C738.379,260.567,738.379,267.133,738.379,270.417L738.379,273.7"/><path marker-end="url(#mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-AL2 LE-AL3" id="L-AL2-AL3-0" d="M738.379,331L738.379,335.167C738.379,339.333,738.379,347.667,738.379,355.117C738.379,362.567,738.379,369.133,738.379,372.417L738.379,375.7"/><path marker-end="url(#mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-AL3 LE-SL1" id="L-AL3-SL1-0" d="M738.379,433L738.379,437.167C738.379,441.333,738.379,449.667,738.379,458C738.379,466.333,738.379,474.667,738.379,483C738.379,491.333,738.379,499.667,738.379,507.117C738.379,514.567,738.379,521.133,738.379,524.417L738.379,527.7"/><path marker-end="url(#mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-SL1 LE-SL2" id="L-SL1-SL2-0" d="M669.43,564.43L572.992,572.025C476.553,579.62,283.677,594.81,187.239,606.572C90.801,618.333,90.801,626.667,90.801,634.117C90.801,641.567,90.801,648.133,90.801,651.417L90.801,654.7"/><path marker-end="url(#mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-SL1 LE-SL3" id="L-SL1-SL3-0" d="M669.43,566.351L601.193,573.626C532.957,580.901,396.484,595.45,328.248,606.892C260.012,618.333,260.012,626.667,260.012,634.117C260.012,641.567,260.012,648.133,260.012,651.417L260.012,654.7"/><path marker-end="url(#mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-SL1 LE-SL4" id="L-SL1-SL4-0" d="M669.43,570.978L631.992,577.482C594.555,583.985,519.68,596.993,482.242,607.663C444.805,618.333,444.805,626.667,444.805,634.117C444.805,641.567,444.805,648.133,444.805,651.417L444.805,654.7"/><path marker-end="url(#mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-SL1 LE-DL1" id="L-SL1-DL1-0" d="M749.582,585L751.377,589.167C753.172,593.333,756.763,601.667,758.558,610C760.354,618.333,760.354,626.667,783.531,636.453C806.708,646.239,853.063,657.478,876.24,663.097L899.418,668.717"/><path marker-end="url(#mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-SL1 LE-DL2" id="L-SL1-DL2-0" d="M759.778,585L763.207,589.167C766.636,593.333,773.495,601.667,776.924,610C780.354,618.333,780.354,626.667,830.558,637.456C880.762,648.246,981.171,661.492,1031.375,668.114L1081.58,674.737"/><path marker-end="url(#mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-SL1 LE-DL3" id="L-SL1-DL3-0" d="M769.974,585L775.037,589.167C780.1,593.333,790.227,601.667,795.29,610C800.354,618.333,800.354,626.667,882.261,638.36C964.168,650.053,1127.983,665.105,1209.891,672.632L1291.798,680.158"/><path marker-end="url(#mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-SL1 LE-DL4" id="L-SL1-DL4-0" d="M780.17,585L786.867,589.167C793.564,593.333,806.959,601.667,813.656,610C820.354,618.333,820.354,626.667,926.692,638.323C1033.03,649.979,1245.707,664.959,1352.045,672.449L1458.383,679.938"/><path marker-end="url(#mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-DL2 LE-RL1" id="L-DL2-RL1-0" d="M1166.955,712L1166.955,716.167C1166.955,720.333,1166.955,728.667,1166.955,737C1166.955,745.333,1166.955,753.667,1166.955,762C1166.955,770.333,1166.955,778.667,1166.955,786.117C1166.955,793.567,1166.955,800.133,1166.955,803.417L1166.955,806.7"/><path marker-end="url(#mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-RL1 LE-RL2" id="L-RL1-RL2-0" d="M1116.441,864L1108.345,868.167C1100.25,872.333,1084.06,880.667,1075.964,889C1067.869,897.333,1067.869,905.667,1067.869,914C1067.869,922.333,1067.869,930.667,1067.869,938.117C1067.869,945.567,1067.869,952.133,1067.869,955.417L1067.869,958.7"/><path marker-end="url(#mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-RL1 LE-RL3" id="L-RL1-RL3-0" d="M1217.469,864L1225.565,868.167C1233.66,872.333,1249.851,880.667,1257.946,889C1266.041,897.333,1266.041,905.667,1266.041,914C1266.041,922.333,1266.041,930.667,1266.041,938.117C1266.041,945.567,1266.041,952.133,1266.041,955.417L1266.041,958.7"/><path marker-end="url(#mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-RL1 LE-RL4" id="L-RL1-RL4-0" d="M1246.936,852.42L1280.749,858.517C1314.563,864.614,1382.191,876.807,1416.005,887.07C1449.818,897.333,1449.818,905.667,1449.818,914C1449.818,922.333,1449.818,930.667,1449.818,938.117C1449.818,945.567,1449.818,952.133,1449.818,955.417L1449.818,958.7"/><path marker-end="url(#mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-RL1 LE-DB1" id="L-RL1-DB1-0" d="M1090.351,864L1078.075,868.167C1065.798,872.333,1041.246,880.667,1028.97,889C1016.693,897.333,1016.693,905.667,1016.693,914C1016.693,922.333,1016.693,930.667,930.064,942.258C843.435,953.849,670.176,968.697,583.547,976.121L496.917,983.546"/><path marker-end="url(#mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-DB1 LE-DB2" id="L-DB1-DB2-0" d="M351.574,1002.923L317.182,1009.269C282.79,1015.615,214.005,1028.308,179.613,1038.82C145.221,1049.333,145.221,1057.667,145.221,1065.117C145.221,1072.567,145.221,1079.133,145.221,1082.417L145.221,1085.7"/><path marker-end="url(#mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-DB1 LE-DB3" id="L-DB1-DB3-0" d="M374.76,1016L367.253,1020.167C359.746,1024.333,344.731,1032.667,337.224,1041C329.717,1049.333,329.717,1057.667,329.717,1065.117C329.717,1072.567,329.717,1079.133,329.717,1082.417L329.717,1085.7"/><path marker-end="url(#mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-DB1 LE-DB4" id="L-DB1-DB4-0" d="M471.484,1016L479.477,1020.167C487.47,1024.333,503.457,1032.667,511.45,1041C519.443,1049.333,519.443,1057.667,519.443,1065.117C519.443,1072.567,519.443,1079.133,519.443,1082.417L519.443,1085.7"/><path marker-end="url(#mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-SL2 LE-EX1" id="L-SL2-EX1-0" d="M90.801,712L90.801,716.167C90.801,720.333,90.801,728.667,90.801,737C90.801,745.333,90.801,753.667,90.801,762C90.801,770.333,90.801,778.667,90.801,786.117C90.801,793.567,90.801,800.133,90.801,803.417L90.801,806.7"/><path marker-end="url(#mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-SL3 LE-EX2" id="L-SL3-EX2-0" d="M260.012,712L260.012,716.167C260.012,720.333,260.012,728.667,260.012,737C260.012,745.333,260.012,753.667,260.012,762C260.012,770.333,260.012,778.667,260.012,786.117C260.012,793.567,260.012,800.133,260.012,803.417L260.012,806.7"/><path marker-end="url(#mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-SL1 LE-EX3" id="L-SL1-EX3-0" d="M669.43,577.552L649.331,582.96C629.233,588.368,589.036,599.184,568.938,608.759C548.84,618.333,548.84,626.667,548.84,639.333C548.84,652,548.84,669,548.84,686C548.84,703,548.84,720,548.84,732.667C548.84,745.333,548.84,753.667,548.84,762C548.84,770.333,548.84,778.667,548.84,786.117C548.84,793.567,548.84,800.133,548.84,803.417L548.84,806.7"/><path marker-end="url(#mermaid-svg-1749809626743-9t2psmgqr_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-SL1 LE-EX4" id="L-SL1-EX4-0" d="M738.379,585L738.379,589.167C738.379,593.333,738.379,601.667,738.379,610C738.379,618.333,738.379,626.667,738.379,639.333C738.379,652,738.379,669,738.379,686C738.379,703,738.379,720,738.379,732.667C738.379,745.333,738.379,753.667,738.379,762C738.379,770.333,738.379,778.667,738.379,786.117C738.379,793.567,738.379,800.133,738.379,803.417L738.379,806.7"/></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(90.80078125, 838)" id="flowchart-EX1-885" class="node default default flowchart-label"><rect height="52" width="111.6015625" y="-26" x="-55.80078125" ry="0" rx="0" style="fill:#f1f8e9;" class="basic label-container"/><g transform="translate(-48.30078125, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="96.6015625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Meter System<br />Usage Events</span></div></foreignObject></g></g><g transform="translate(260.01171875, 838)" id="flowchart-EX2-886" class="node default default flowchart-label"><rect height="52" width="105.8359375" y="-26" x="-52.91796875" ry="0" rx="0" style="fill:#f1f8e9;" class="basic label-container"/><g transform="translate(-45.41796875, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="90.8359375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Price System<br />Pricing Rules</span></div></foreignObject></g></g><g transform="translate(548.83984375, 838)" id="flowchart-EX3-887" class="node default default flowchart-label"><rect height="52" width="118.4921875" y="-26" x="-59.24609375" ry="0" rx="0" style="fill:#f1f8e9;" class="basic label-container"/><g transform="translate(-51.74609375, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="103.4921875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Tenant System<br />Multi-tenancy</span></div></foreignObject></g></g><g transform="translate(738.37890625, 838)" id="flowchart-EX4-888" class="node default default flowchart-label"><rect height="52" width="160.5859375" y="-26" x="-80.29296875" ry="0" rx="0" style="fill:#f1f8e9;" class="basic label-container"/><g transform="translate(-72.79296875, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="145.5859375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Environment System<br />Env Isolation</span></div></foreignObject></g></g><g transform="translate(421.60546875, 990)" id="flowchart-DB1-881" class="node default default flowchart-label"><rect height="52" width="140.0625" y="-26" x="-70.03125" ry="0" rx="0" style="fill:#f3e5f5;" class="basic label-container"/><g transform="translate(-62.53125, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="125.0625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">PostgreSQL<br />Primary Database</span></div></foreignObject></g></g><g transform="translate(145.220703125, 1117)" id="flowchart-DB2-882" class="node default default flowchart-label"><rect height="52" width="154.890625" y="-26" x="-77.4453125" ry="0" rx="0" style="fill:#f3e5f5;" class="basic label-container"/><g transform="translate(-69.9453125, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="139.890625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Indexes<br />Query Optimization</span></div></foreignObject></g></g><g transform="translate(329.716796875, 1117)" id="flowchart-DB3-883" class="node default default flowchart-label"><rect height="52" width="114.1015625" y="-26" x="-57.05078125" ry="0" rx="0" style="fill:#f3e5f5;" class="basic label-container"/><g transform="translate(-49.55078125, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="99.1015625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Constraints<br />Data Integrity</span></div></foreignObject></g></g><g transform="translate(519.443359375, 1117)" id="flowchart-DB4-884" class="node default default flowchart-label"><rect height="52" width="165.3515625" y="-26" x="-82.67578125" ry="0" rx="0" style="fill:#f3e5f5;" class="basic label-container"/><g transform="translate(-75.17578125, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="150.3515625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Migrations<br />Schema Management</span></div></foreignObject></g></g><g transform="translate(1166.955078125, 838)" id="flowchart-RL1-877" class="node default default flowchart-label"><rect height="52" width="159.9609375" y="-26" x="-79.98046875" ry="0" rx="0" style="fill:#fce4ec;" class="basic label-container"/><g transform="translate(-72.48046875, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="144.9609375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">CostsheetRepository<br />Data Access</span></div></foreignObject></g></g><g transform="translate(1067.869140625, 990)" id="flowchart-RL2-878" class="node default default flowchart-label"><rect height="52" width="134.703125" y="-26" x="-67.3515625" ry="0" rx="0" style="fill:#fce4ec;" class="basic label-container"/><g transform="translate(-59.8515625, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="119.703125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Query Builder<br />Dynamic Queries</span></div></foreignObject></g></g><g transform="translate(1266.041015625, 990)" id="flowchart-RL3-879" class="node default default flowchart-label"><rect height="52" width="161.640625" y="-26" x="-80.8203125" ry="0" rx="0" style="fill:#fce4ec;" class="basic label-container"/><g transform="translate(-73.3203125, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="146.640625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Transaction Manager<br />Data Consistency</span></div></foreignObject></g></g><g transform="translate(1449.818359375, 990)" id="flowchart-RL4-880" class="node default default flowchart-label"><rect height="52" width="105.9140625" y="-26" x="-52.95703125" ry="0" rx="0" style="fill:#fce4ec;" class="basic label-container"/><g transform="translate(-45.45703125, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="90.9140625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Cache Layer<br />Performance</span></div></foreignObject></g></g><g transform="translate(970.701171875, 686)" id="flowchart-DL1-873" class="node default default flowchart-label"><rect height="52" width="132.265625" y="-26" x="-66.1328125" ry="0" rx="0" style="fill:#fff3e0;" class="basic label-container"/><g transform="translate(-58.6328125, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="117.265625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Costsheet Entity<br />Domain Model</span></div></foreignObject></g></g><g transform="translate(1166.955078125, 686)" id="flowchart-DL2-874" class="node default default flowchart-label"><rect height="52" width="160.2421875" y="-26" x="-80.12109375" ry="0" rx="0" style="fill:#fff3e0;" class="basic label-container"/><g transform="translate(-72.62109375, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="145.2421875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Repository Interface<br />Data Contract</span></div></foreignObject></g></g><g transform="translate(1355.373046875, 686)" id="flowchart-DL3-875" class="node default default flowchart-label"><rect height="52" width="116.59375" y="-26" x="-58.296875" ry="0" rx="0" style="fill:#fff3e0;" class="basic label-container"/><g transform="translate(-50.796875, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="101.59375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Business Rules<br />Domain Logic</span></div></foreignObject></g></g><g transform="translate(1544.443359375, 686)" id="flowchart-DL4-876" class="node default default flowchart-label"><rect height="52" width="161.546875" y="-26" x="-80.7734375" ry="0" rx="0" style="fill:#fff3e0;" class="basic label-container"/><g transform="translate(-73.2734375, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="146.546875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Filter Objects<br />Query Specifications</span></div></foreignObject></g></g><g transform="translate(738.37890625, 559)" id="flowchart-SL1-869" class="node default default flowchart-label"><rect height="52" width="137.8984375" y="-26" x="-68.94921875" ry="0" rx="0" style="fill:#e8f5e8;" class="basic label-container"/><g transform="translate(-61.44921875, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="122.8984375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">CostSheetService<br />Business Logic</span></div></foreignObject></g></g><g transform="translate(90.80078125, 686)" id="flowchart-SL2-870" class="node default default flowchart-label"><rect height="52" width="106.90625" y="-26" x="-53.453125" ry="0" rx="0" style="fill:#e8f5e8;" class="basic label-container"/><g transform="translate(-45.953125, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="91.90625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">EventService<br />Usage Data</span></div></foreignObject></g></g><g transform="translate(260.01171875, 686)" id="flowchart-SL3-871" class="node default default flowchart-label"><rect height="52" width="131.515625" y="-26" x="-65.7578125" ry="0" rx="0" style="fill:#e8f5e8;" class="basic label-container"/><g transform="translate(-58.2578125, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="116.515625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">PriceService<br />Cost Calculation</span></div></foreignObject></g></g><g transform="translate(444.8046875, 686)" id="flowchart-SL4-872" class="node default default flowchart-label"><rect height="52" width="138.0703125" y="-26" x="-69.03515625" ry="0" rx="0" style="fill:#e8f5e8;" class="basic label-container"/><g transform="translate(-61.53515625, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="123.0703125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">ValidationService<br />Data Validation</span></div></foreignObject></g></g><g transform="translate(738.37890625, 203)" id="flowchart-AL1-866" class="node default default flowchart-label"><rect height="52" width="139" y="-26" x="-69.5" ry="0" rx="0" style="fill:#e8eaf6;" class="basic label-container"/><g transform="translate(-62, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="124"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Controllers<br />Request Handling</span></div></foreignObject></g></g><g transform="translate(738.37890625, 305)" id="flowchart-AL2-867" class="node default default flowchart-label"><rect height="52" width="130.34375" y="-26" x="-65.171875" ry="0" rx="0" style="fill:#e8eaf6;" class="basic label-container"/><g transform="translate(-57.671875, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="115.34375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Middleware<br />Auth, Validation</span></div></foreignObject></g></g><g transform="translate(738.37890625, 407)" id="flowchart-AL3-868" class="node default default flowchart-label"><rect height="52" width="170.5859375" y="-26" x="-85.29296875" ry="0" rx="0" style="fill:#e8eaf6;" class="basic label-container"/><g transform="translate(-77.79296875, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="155.5859375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">DTOs<br />Data Transfer Objects</span></div></foreignObject></g></g><g transform="translate(738.37890625, 51)" id="flowchart-CL-865" class="node default default flowchart-label"><rect height="52" width="115.0390625" y="-26" x="-57.51953125" ry="0" rx="0" style="fill:#e3f2fd;" class="basic label-container"/><g transform="translate(-50.01953125, -18.5)" style="" class="label"><rect/><foreignObject height="37" width="100.0390625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">HTTP Client<br />REST API Calls</span></div></foreignObject></g></g></g></g></g></svg>