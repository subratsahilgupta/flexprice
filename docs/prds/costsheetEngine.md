# Cost Sheet Engine PRD

### _Broader Concept of Cost Sheet Engine_

## 1. Overview

The Cost Sheet Engine enables developers to track their input costs and calculate margins for customer subscriptions. This initial implementation focuses on the core functionality of cost tracking and basic margin calculations.

## 2. Base Requirements

1. Reuse existing infrastructure:
   - Meters table - for usage tracking
   - Prices table - for cost modeling
   
2. New components:
   - Cost sheets table - for storing cost sheet records
   - Cost sheet items table - for tracking input costs
   - Basic margin calculation
   - Cost sheet API endpoints

## 3. Core Components

### 3.1 Database Schema
-- Parent record for cost sheets
CREATE TABLE public.cost_sheets (
    id              VARCHAR(50) DEFAULT extensions.uuid_generate_v4() PRIMARY KEY,
    tenant_id       VARCHAR(50) NOT NULL,
    environment_id  VARCHAR(50) NOT NULL,
    name            VARCHAR(120),
    status          VARCHAR(20) DEFAULT 'published' NOT NULL,
    created_at      TIMESTAMPTZ DEFAULT now(),
    updated_at      TIMESTAMPTZ DEFAULT now()
);

-- Line items for cost sheets
CREATE TABLE public.cost_sheet_items (
    id              VARCHAR(50) DEFAULT extensions.uuid_generate_v4() PRIMARY KEY,
    cost_sheet_id   VARCHAR(50) NOT NULL,
    meter_id        VARCHAR(50) NOT NULL,
    price_id        VARCHAR(50) NOT NULL,
    status          VARCHAR(20) DEFAULT 'published' NOT NULL,
    FOREIGN KEY (cost_sheet_id) REFERENCES cost_sheets(id),
    FOREIGN KEY (meter_id)      REFERENCES meters(id),
    FOREIGN KEY (price_id)      REFERENCES prices(id)
);

### 3.2 Workflow

1. **Cost Sheet Creation**
   - Developer creates cost sheet with name
   - System generates cost sheet record
   - Cost sheet is stored with 'published' status

2. **Cost Sheet Item Creation**
   - Developer adds cost items to sheet with meter and price
   - System validates meter and price existence
   - Cost item is stored with 'published' status

2. **Cost Calculation**
   - Fetch all published cost items for tenant/environment
   - For each meter × price pair:
     - Get usage by meter
     - Calculate cost (usage.Quantity × price)
   - Return total input cost

3. **Margin Calculation**
   - Input: TotalInputCost, TotalRevenue
   - Calculate: margin = (TotalRevenue - TotalCost) / TotalCost
   - Return margin percentage
   - Store results in cost_sheets table for analysis

## 4. API Endpoints

### 4.1 Cost Sheets

#### Create Cost Sheet
```http
POST /cost_sheets
{
    "name": "string",
    "tenant_id": "string",
    "environment_id": "string"
}
```

#### Add Cost Item
```http
POST /cost_sheets/{sheet_id}/items
{
    "meter_id": "string",
    "price_id": "string"
}
```

#### List Cost Items
```http
GET /cost_sheets/{sheet_id}/items
```

#### Get Cost Sheet
```http
GET /subscriptions/{id}/cost_sheet
Response:
{
    "input_costs": {
        "total": "decimal",
        "items": [
            {
                "meter_id": "string",
                "usage": "decimal",
                "cost": "decimal"
            }
        ]
    },
    "revenue": "decimal",
    "margin": "decimal"
}
```

## 5. Implementation Steps

1. **Phase 1: Infrastructure**
   - Create cost_sheets and cost_sheet_items tables
   - Set up basic CRUD operations
   - Implement input validation

2. **Phase 2: Cost Calculation**
   - Implement GetUsageByMeter
   - Add cost calculation logic
   - Create cost aggregation

3. **Phase 3: Margin Analysis**
   - Add margin calculation
   - Integrate with subscription data
   - Create cost sheet endpoint

## 6. Service Interfaces

### CostSheetService
```go
type CostSheetService interface {
    CreateCostSheet(ctx context.Context, req *dto.CreateCostSheetRequest) (*dto.CostSheet, error)
    AddCostSheetItem(ctx context.Context, req *dto.CreateCostSheetItemRequest) (*dto.CostSheetItem, error)
    GetInputCostForMargin(ctx context.Context, req *dto.GetInputCostRequest) (*dto.GetInputCostResponse, error)
    GetUsageByMeter(ctx context.Context, meterID string) (*dto.Usage, error)
    CalculateCost(usage decimal.Decimal, price *Price) decimal.Decimal
}
```

### Margin Service
```go
type MarginService interface {
    CalculateMargin(totalCost, totalRevenue decimal.Decimal) decimal.Decimal
}
``` 



### Visuals

## Business Flow

<svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="-7.500000476837158 -8 470.5422058105469 1102.800048828125" style="max-width: 470.5422058105469px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-svg-1749435772987-82bzot2wd"><style>#mermaid-svg-1749435772987-82bzot2wd{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749435772987-82bzot2wd .error-icon{fill:#bf616a;}#mermaid-svg-1749435772987-82bzot2wd .error-text{fill:#bf616a;stroke:#bf616a;}#mermaid-svg-1749435772987-82bzot2wd .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-1749435772987-82bzot2wd .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-1749435772987-82bzot2wd .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-1749435772987-82bzot2wd .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-1749435772987-82bzot2wd .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-1749435772987-82bzot2wd .marker{fill:rgba(204, 204, 204, 0.87);stroke:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749435772987-82bzot2wd .marker.cross{stroke:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749435772987-82bzot2wd svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-1749435772987-82bzot2wd .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749435772987-82bzot2wd .cluster-label text{fill:#ffffff;}#mermaid-svg-1749435772987-82bzot2wd .cluster-label span,#mermaid-svg-1749435772987-82bzot2wd p{color:#ffffff;}#mermaid-svg-1749435772987-82bzot2wd .label text,#mermaid-svg-1749435772987-82bzot2wd span,#mermaid-svg-1749435772987-82bzot2wd p{fill:rgba(204, 204, 204, 0.87);color:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749435772987-82bzot2wd .node rect,#mermaid-svg-1749435772987-82bzot2wd .node circle,#mermaid-svg-1749435772987-82bzot2wd .node ellipse,#mermaid-svg-1749435772987-82bzot2wd .node polygon,#mermaid-svg-1749435772987-82bzot2wd .node path{fill:#1a1a1a;stroke:#2a2a2a;stroke-width:1px;}#mermaid-svg-1749435772987-82bzot2wd .flowchart-label text{text-anchor:middle;}#mermaid-svg-1749435772987-82bzot2wd .node .label{text-align:center;}#mermaid-svg-1749435772987-82bzot2wd .node.clickable{cursor:pointer;}#mermaid-svg-1749435772987-82bzot2wd .arrowheadPath{fill:#e5e5e5;}#mermaid-svg-1749435772987-82bzot2wd .edgePath .path{stroke:rgba(204, 204, 204, 0.87);stroke-width:2.0px;}#mermaid-svg-1749435772987-82bzot2wd .flowchart-link{stroke:rgba(204, 204, 204, 0.87);fill:none;}#mermaid-svg-1749435772987-82bzot2wd .edgeLabel{background-color:#1a1a1a99;text-align:center;}#mermaid-svg-1749435772987-82bzot2wd .edgeLabel rect{opacity:0.5;background-color:#1a1a1a99;fill:#1a1a1a99;}#mermaid-svg-1749435772987-82bzot2wd .labelBkg{background-color:rgba(26, 26, 26, 0.5);}#mermaid-svg-1749435772987-82bzot2wd .cluster rect{fill:rgba(64, 64, 64, 0.47);stroke:#30373a;stroke-width:1px;}#mermaid-svg-1749435772987-82bzot2wd .cluster text{fill:#ffffff;}#mermaid-svg-1749435772987-82bzot2wd .cluster span,#mermaid-svg-1749435772987-82bzot2wd p{color:#ffffff;}#mermaid-svg-1749435772987-82bzot2wd div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:#88c0d0;border:1px solid #30373a;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-1749435772987-82bzot2wd .flowchartTitleText{text-anchor:middle;font-size:18px;fill:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749435772987-82bzot2wd :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="6" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749435772987-82bzot2wd_flowchart-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"/></marker><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749435772987-82bzot2wd_flowchart-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749435772987-82bzot2wd_flowchart-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749435772987-82bzot2wd_flowchart-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart" id="mermaid-svg-1749435772987-82bzot2wd_flowchart-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart" id="mermaid-svg-1749435772987-82bzot2wd_flowchart-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><g class="root"><g class="clusters"/><g class="edgePaths"/><g class="edgeLabels"/><g class="nodes"><g transform="translate(-7.5, -8)" class="root"><g class="clusters"><g id="subGraph0" class="cluster default flowchart-label"><rect height="1086.8000297546387" width="454.54218673706055" y="8" x="8" ry="0" rx="0" style=""/><g transform="translate(186.4367160797119, 8)" class="cluster-label"><foreignObject height="18.600000381469727" width="97.66875457763672"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Business Flow</span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid-svg-1749435772987-82bzot2wd_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-B" id="L-A-B-0" d="M238.273,66.6L238.273,70.767C238.273,74.933,238.273,83.267,238.273,90.717C238.273,98.167,238.273,104.733,238.273,108.017L238.273,111.3"/><path marker-end="url(#mermaid-svg-1749435772987-82bzot2wd_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-C" id="L-B-C-0" d="M195.972,150.2L185.481,154.367C174.989,158.533,154.006,166.867,143.515,174.317C133.023,181.767,133.023,188.333,133.023,191.617L133.023,194.9"/><path marker-end="url(#mermaid-svg-1749435772987-82bzot2wd_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-C LE-D" id="L-C-D-0" d="M133.023,233.8L133.023,237.967C133.023,242.133,133.023,250.467,133.023,257.917C133.023,265.367,133.023,271.933,133.023,275.217L133.023,278.5"/><path marker-end="url(#mermaid-svg-1749435772987-82bzot2wd_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D LE-E" id="L-D-E-0" d="M133.023,317.4L133.023,321.567C133.023,325.733,133.023,334.067,133.023,341.517C133.023,348.967,133.023,355.533,133.023,358.817L133.023,362.1"/><path marker-end="url(#mermaid-svg-1749435772987-82bzot2wd_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-E LE-F" id="L-E-F-0" d="M133.023,401L133.023,405.167C133.023,409.333,133.023,417.667,133.023,425.117C133.023,432.567,133.023,439.133,133.023,442.417L133.023,445.7"/><path marker-end="url(#mermaid-svg-1749435772987-82bzot2wd_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-F LE-G" id="L-F-G-0" d="M133.023,484.6L133.023,488.767C133.023,492.933,133.023,501.267,133.023,508.717C133.023,516.167,133.023,522.733,133.023,526.017L133.023,529.3"/><path marker-end="url(#mermaid-svg-1749435772987-82bzot2wd_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-G LE-H" id="L-G-H-0" d="M133.023,568.2L133.023,572.367C133.023,576.533,133.023,584.867,133.023,592.317C133.023,599.767,133.023,606.333,133.023,609.617L133.023,612.9"/><path marker-end="url(#mermaid-svg-1749435772987-82bzot2wd_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-H LE-I" id="L-H-I-0" d="M133.023,651.8L133.023,655.967C133.023,660.133,133.023,668.467,133.023,675.917C133.023,683.367,133.023,689.933,133.023,693.217L133.023,696.5"/><path marker-end="url(#mermaid-svg-1749435772987-82bzot2wd_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-J" id="L-B-J-0" d="M280.575,150.2L291.066,154.367C301.558,158.533,322.541,166.867,333.032,178C343.523,189.133,343.523,203.067,343.523,217C343.523,230.933,343.523,244.867,343.523,258.8C343.523,272.733,343.523,286.667,343.523,300.6C343.523,314.533,343.523,328.467,343.523,342.4C343.523,356.333,343.523,370.267,343.523,384.2C343.523,398.133,343.523,412.067,343.523,426C343.523,439.933,343.523,453.867,343.523,467.8C343.523,481.733,343.523,495.667,343.523,509.6C343.523,523.533,343.523,537.467,343.523,551.4C343.523,565.333,343.523,579.267,343.523,589.517C343.523,599.767,343.523,606.333,343.523,609.617L343.523,612.9"/><path marker-end="url(#mermaid-svg-1749435772987-82bzot2wd_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-J LE-K" id="L-J-K-0" d="M343.523,651.8L343.523,655.967C343.523,660.133,343.523,668.467,343.523,675.917C343.523,683.367,343.523,689.933,343.523,693.217L343.523,696.5"/><path marker-end="url(#mermaid-svg-1749435772987-82bzot2wd_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-I LE-L" id="L-I-L-0" d="M133.023,735.4L133.023,739.567C133.023,743.733,133.023,752.067,142.694,760.074C152.364,768.081,171.705,775.763,181.376,779.603L191.046,783.444"/><path marker-end="url(#mermaid-svg-1749435772987-82bzot2wd_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-K LE-L" id="L-K-L-0" d="M343.523,735.4L343.523,739.567C343.523,743.733,343.523,752.067,333.853,760.074C324.183,768.081,304.842,775.763,295.171,779.603L285.501,783.444"/><path marker-end="url(#mermaid-svg-1749435772987-82bzot2wd_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-L LE-M" id="L-L-M-0" d="M238.273,819L238.273,823.167C238.273,827.333,238.273,835.667,238.273,843.117C238.273,850.567,238.273,857.133,238.273,860.417L238.273,863.7"/><path marker-end="url(#mermaid-svg-1749435772987-82bzot2wd_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-M LE-N" id="L-M-N-0" d="M238.273,902.6L238.273,906.767C238.273,910.933,238.273,919.267,238.273,926.717C238.273,934.167,238.273,940.733,238.273,944.017L238.273,947.3"/><path marker-end="url(#mermaid-svg-1749435772987-82bzot2wd_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-N LE-O" id="L-N-O-0" d="M238.273,986.2L238.273,990.367C238.273,994.533,238.273,1002.867,238.273,1010.317C238.273,1017.767,238.273,1024.333,238.273,1027.617L238.273,1030.9"/></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(238.2734375, 49.80000114440918)" id="flowchart-A-1208" class="node default default flowchart-label"><rect height="33.60000038146973" width="175.40625" y="-16.800000190734863" x="-87.703125" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-80.203125, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="160.40625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Customer Subscription</span></div></foreignObject></g></g><g transform="translate(238.2734375, 133.40000343322754)" id="flowchart-B-1209" class="node default default flowchart-label"><rect height="33.60000038146973" width="89.22187805175781" y="-16.800000190734863" x="-44.610939025878906" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-37.110939025878906, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="74.22187805175781"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Line Items</span></div></foreignObject></g></g><g transform="translate(133.0234375, 217.0000057220459)" id="flowchart-C-1210" class="node default default flowchart-label"><rect height="33.60000038146973" width="143.8125" y="-16.800000190734863" x="-71.90625" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-64.40625, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="128.8125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Create Cost Sheet</span></div></foreignObject></g></g><g transform="translate(133.0234375, 300.60000801086426)" id="flowchart-D-1211" class="node default default flowchart-label"><rect height="33.60000038146973" width="167.18438720703125" y="-16.800000190734863" x="-83.59219360351562" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-76.09219360351562, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="152.18438720703125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Add Cost Sheet Items</span></div></foreignObject></g></g><g transform="translate(133.0234375, 384.2000102996826)" id="flowchart-E-1212" class="node default default flowchart-label"><rect height="33.60000038146973" width="131.4937515258789" y="-16.800000190734863" x="-65.74687576293945" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-58.24687576293945, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="116.4937515258789"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Cost Calculation</span></div></foreignObject></g></g><g transform="translate(133.0234375, 467.800012588501)" id="flowchart-F-1213" class="node default default flowchart-label"><rect height="33.60000038146973" width="180.046875" y="-16.800000190734863" x="-90.0234375" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-82.5234375, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="165.046875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Fetch Cost Sheet Items</span></div></foreignObject></g></g><g transform="translate(133.0234375, 551.4000148773193)" id="flowchart-G-1214" class="node default default flowchart-label"><rect height="33.60000038146973" width="125.4937515258789" y="-16.800000190734863" x="-62.74687576293945" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-55.24687576293945, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="110.4937515258789"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Get Usage Data</span></div></foreignObject></g></g><g transform="translate(133.0234375, 635.0000171661377)" id="flowchart-H-1215" class="node default default flowchart-label"><rect height="33.60000038146973" width="160.3312530517578" y="-16.800000190734863" x="-80.1656265258789" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-72.6656265258789, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="145.3312530517578"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Calculate Input Cost</span></div></foreignObject></g></g><g transform="translate(133.0234375, 718.600019454956)" id="flowchart-I-1216" class="node default default flowchart-label"><rect height="33.60000038146973" width="86.13750457763672" y="-16.800000190734863" x="-43.06875228881836" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-35.56875228881836, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="71.13750457763672"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Total Cost</span></div></foreignObject></g></g><g transform="translate(343.5234375, 635.0000171661377)" id="flowchart-J-1217" class="node default default flowchart-label"><rect height="33.60000038146973" width="160.66876220703125" y="-16.800000190734863" x="-80.33438110351562" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-72.83438110351562, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="145.66876220703125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Revenue Calculation</span></div></foreignObject></g></g><g transform="translate(343.5234375, 718.600019454956)" id="flowchart-K-1218" class="node default default flowchart-label"><rect height="33.60000038146973" width="115.31251525878906" y="-16.800000190734863" x="-57.65625762939453" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-50.15625762939453, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="100.31251525878906"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Total Revenue</span></div></foreignObject></g></g><g transform="translate(238.2734375, 802.2000217437744)" id="flowchart-L-1219" class="node default default flowchart-label"><rect height="33.60000038146973" width="134.66250610351562" y="-16.800000190734863" x="-67.33125305175781" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-59.83125305175781, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="119.66250610351562"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Calculate Margin</span></div></foreignObject></g></g><g transform="translate(238.2734375, 885.8000240325928)" id="flowchart-M-1220" class="node default default flowchart-label"><rect height="33.60000038146973" width="162.5343780517578" y="-16.800000190734863" x="-81.2671890258789" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-73.7671890258789, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="147.5343780517578"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Generate Cost Sheet</span></div></foreignObject></g></g><g transform="translate(238.2734375, 969.4000263214111)" id="flowchart-N-1221" class="node default default flowchart-label"><rect height="33.60000038146973" width="158.6906280517578" y="-16.800000190734863" x="-79.3453140258789" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-71.8453140258789, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="143.6906280517578"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Store in cost_sheets</span></div></foreignObject></g></g><g transform="translate(238.2734375, 1053.0000286102295)" id="flowchart-O-1222" class="node default default flowchart-label"><rect height="33.60000038146973" width="100.1812515258789" y="-16.800000190734863" x="-50.09062576293945" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-42.59062576293945, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="85.1812515258789"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">ROI Analysis</span></div></foreignObject></g></g></g></g></g></g></g></svg>


## Technical Architecture

<svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="-8 -8 1584.846923828125 285" style="max-width: 1584.846923828125px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-svg-1749435779491-6bevu8e9n"><style>#mermaid-svg-1749435779491-6bevu8e9n{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749435779491-6bevu8e9n .error-icon{fill:#bf616a;}#mermaid-svg-1749435779491-6bevu8e9n .error-text{fill:#bf616a;stroke:#bf616a;}#mermaid-svg-1749435779491-6bevu8e9n .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-1749435779491-6bevu8e9n .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-1749435779491-6bevu8e9n .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-1749435779491-6bevu8e9n .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-1749435779491-6bevu8e9n .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-1749435779491-6bevu8e9n .marker{fill:rgba(204, 204, 204, 0.87);stroke:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749435779491-6bevu8e9n .marker.cross{stroke:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749435779491-6bevu8e9n svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-1749435779491-6bevu8e9n .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749435779491-6bevu8e9n .cluster-label text{fill:#ffffff;}#mermaid-svg-1749435779491-6bevu8e9n .cluster-label span,#mermaid-svg-1749435779491-6bevu8e9n p{color:#ffffff;}#mermaid-svg-1749435779491-6bevu8e9n .label text,#mermaid-svg-1749435779491-6bevu8e9n span,#mermaid-svg-1749435779491-6bevu8e9n p{fill:rgba(204, 204, 204, 0.87);color:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749435779491-6bevu8e9n .node rect,#mermaid-svg-1749435779491-6bevu8e9n .node circle,#mermaid-svg-1749435779491-6bevu8e9n .node ellipse,#mermaid-svg-1749435779491-6bevu8e9n .node polygon,#mermaid-svg-1749435779491-6bevu8e9n .node path{fill:#1a1a1a;stroke:#2a2a2a;stroke-width:1px;}#mermaid-svg-1749435779491-6bevu8e9n .flowchart-label text{text-anchor:middle;}#mermaid-svg-1749435779491-6bevu8e9n .node .label{text-align:center;}#mermaid-svg-1749435779491-6bevu8e9n .node.clickable{cursor:pointer;}#mermaid-svg-1749435779491-6bevu8e9n .arrowheadPath{fill:#e5e5e5;}#mermaid-svg-1749435779491-6bevu8e9n .edgePath .path{stroke:rgba(204, 204, 204, 0.87);stroke-width:2.0px;}#mermaid-svg-1749435779491-6bevu8e9n .flowchart-link{stroke:rgba(204, 204, 204, 0.87);fill:none;}#mermaid-svg-1749435779491-6bevu8e9n .edgeLabel{background-color:#1a1a1a99;text-align:center;}#mermaid-svg-1749435779491-6bevu8e9n .edgeLabel rect{opacity:0.5;background-color:#1a1a1a99;fill:#1a1a1a99;}#mermaid-svg-1749435779491-6bevu8e9n .labelBkg{background-color:rgba(26, 26, 26, 0.5);}#mermaid-svg-1749435779491-6bevu8e9n .cluster rect{fill:rgba(64, 64, 64, 0.47);stroke:#30373a;stroke-width:1px;}#mermaid-svg-1749435779491-6bevu8e9n .cluster text{fill:#ffffff;}#mermaid-svg-1749435779491-6bevu8e9n .cluster span,#mermaid-svg-1749435779491-6bevu8e9n p{color:#ffffff;}#mermaid-svg-1749435779491-6bevu8e9n div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:#88c0d0;border:1px solid #30373a;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-1749435779491-6bevu8e9n .flowchartTitleText{text-anchor:middle;font-size:18px;fill:rgba(204, 204, 204, 0.87);}#mermaid-svg-1749435779491-6bevu8e9n :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="6" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749435779491-6bevu8e9n_flowchart-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"/></marker><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749435779491-6bevu8e9n_flowchart-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749435779491-6bevu8e9n_flowchart-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749435779491-6bevu8e9n_flowchart-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart" id="mermaid-svg-1749435779491-6bevu8e9n_flowchart-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart" id="mermaid-svg-1749435779491-6bevu8e9n_flowchart-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><g class="root"><g class="clusters"><g id="subGraph3" class="cluster default flowchart-label"><rect height="269.0000057220459" width="738.0156326293945" y="0" x="830.8312759399414" ry="0" rx="0" style=""/><g transform="translate(1161.2797164916992, 0)" class="cluster-label"><foreignObject height="18.600000381469727" width="77.1187515258789"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Data Layer</span></div></foreignObject></g></g><g id="subGraph1" class="cluster default flowchart-label"><rect height="187.20000457763672" width="388.24375915527344" y="20" x="392.58751678466797" ry="0" rx="0" style=""/><g transform="translate(538.7937698364258, 20)" class="cluster-label"><foreignObject height="18.600000381469727" width="95.83125305175781"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Service Layer</span></div></foreignObject></g></g><g id="subGraph0" class="cluster default flowchart-label"><rect height="187.20000457763672" width="342.58751678466797" y="20" x="0" ry="0" rx="0" style=""/><g transform="translate(137.81094360351562, 20)" class="cluster-label"><foreignObject height="18.600000381469727" width="66.96562957763672"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">API Layer</span></div></foreignObject></g></g><g id="subGraph2" class="cluster default flowchart-label"><rect height="229.0000057220459" width="369.40938568115234" y="20" x="1174.4375228881836" ry="0" rx="0" style=""/><g transform="translate(1301.8750267028809, 20)" class="cluster-label"><foreignObject height="18.600000381469727" width="114.53437805175781"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Database Tables</span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid-svg-1749435779491-6bevu8e9n_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-B" id="L-A-B-0" d="M142.759,71.8L146.926,71.8C151.093,71.8,159.426,71.8,166.876,71.8C174.326,71.8,180.893,71.8,184.176,71.8L187.459,71.8"/><path marker-end="url(#mermaid-svg-1749435779491-6bevu8e9n_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-E" id="L-B-E-0" d="M317.588,71.8L321.754,71.8C325.921,71.8,334.254,71.8,342.588,71.8C350.921,71.8,359.254,71.8,367.588,71.8C375.921,71.8,384.254,71.8,391.704,71.8C399.154,71.8,405.721,71.8,409.004,71.8L412.288,71.8"/><path marker-end="url(#mermaid-svg-1749435779491-6bevu8e9n_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-E LE-F" id="L-E-F-0" d="M565.094,71.8L569.26,71.8C573.427,71.8,581.76,71.8,590.571,71.8C599.382,71.8,608.671,71.8,613.315,71.8L617.959,71.8"/><path marker-end="url(#mermaid-svg-1749435779491-6bevu8e9n_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-F LE-I" id="L-F-I-0" d="M747.666,71.8L753.193,71.8C758.721,71.8,769.776,71.8,779.47,71.8C789.165,71.8,797.498,71.8,805.831,71.8C814.165,71.8,822.498,71.8,829.948,71.8C837.398,71.8,843.965,71.8,847.248,71.8L850.531,71.8"/><path marker-end="url(#mermaid-svg-1749435779491-6bevu8e9n_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-C LE-D" id="L-C-D-0" d="M128.406,155.4L134.965,155.4C141.524,155.4,154.642,155.4,166.877,155.4C179.112,155.4,190.465,155.4,196.141,155.4L201.817,155.4"/><path marker-end="url(#mermaid-svg-1749435779491-6bevu8e9n_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D LE-G" id="L-D-G-0" d="M303.23,155.4L309.789,155.4C316.349,155.4,329.468,155.4,340.195,155.4C350.921,155.4,359.254,155.4,367.588,155.4C375.921,155.4,384.254,155.4,394.096,155.4C403.939,155.4,415.29,155.4,420.965,155.4L426.641,155.4"/><path marker-end="url(#mermaid-svg-1749435779491-6bevu8e9n_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-G LE-H" id="L-G-H-0" d="M550.741,155.4L557.3,155.4C563.858,155.4,576.976,155.4,586.818,155.4C596.66,155.4,603.227,155.4,606.51,155.4L609.794,155.4"/><path marker-end="url(#mermaid-svg-1749435779491-6bevu8e9n_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-H LE-J" id="L-H-J-0" d="M755.831,155.4L759.998,155.4C764.165,155.4,772.498,155.4,780.831,155.4C789.165,155.4,797.498,155.4,805.831,155.4C814.165,155.4,822.498,155.4,832.341,155.4C842.184,155.4,853.536,155.4,859.213,155.4L864.889,155.4"/><path marker-end="url(#mermaid-svg-1749435779491-6bevu8e9n_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-I LE-O" id="L-I-O-0" d="M993.953,71.8L998.12,71.8C1002.286,71.8,1010.62,71.8,1020.546,75.49C1030.472,79.18,1041.992,86.561,1047.751,90.251L1053.511,93.941"/><path marker-end="url(#mermaid-svg-1749435779491-6bevu8e9n_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-J LE-O" id="L-J-O-0" d="M979.595,155.4L986.155,155.4C992.715,155.4,1005.834,155.4,1018.153,151.71C1030.472,148.02,1041.992,140.639,1047.751,136.949L1053.511,133.259"/><path marker-end="url(#mermaid-svg-1749435779491-6bevu8e9n_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-O LE-L" id="L-O-L-0" d="M1110.417,130.4L1116.92,134.567C1123.424,138.733,1136.431,147.067,1147.101,151.233C1157.771,155.4,1166.104,155.4,1173.554,155.4C1181.004,155.4,1187.571,155.4,1190.854,155.4L1194.138,155.4"/><path marker-end="url(#mermaid-svg-1749435779491-6bevu8e9n_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-L LE-M" id="L-L-M-0" d="M1320.356,138.6L1333.048,134.433C1345.739,130.267,1371.123,121.933,1392.528,117.767C1413.932,113.6,1431.358,113.6,1440.071,113.6L1448.784,113.6"/><path marker-end="url(#mermaid-svg-1749435779491-6bevu8e9n_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-L LE-N" id="L-L-N-0" d="M1320.356,172.2L1333.048,176.367C1345.739,180.533,1371.123,188.867,1393.106,193.033C1415.09,197.2,1433.674,197.2,1442.966,197.2L1452.258,197.2"/><path marker-end="url(#mermaid-svg-1749435779491-6bevu8e9n_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-O LE-K" id="L-O-K-0" d="M1110.417,96.8L1116.92,92.633C1123.424,88.467,1136.431,80.133,1147.101,75.967C1157.771,71.8,1166.104,71.8,1176.996,71.8C1187.887,71.8,1201.336,71.8,1208.061,71.8L1214.786,71.8"/></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(1396.5062789916992, 113.60000228881836)" class="edgeLabel"><g transform="translate(-32.578125, -9.300000190734863)" class="label"><foreignObject height="18.600000381469727" width="65.15625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">meter_id</span></div></foreignObject></g></g><g transform="translate(1396.5062789916992, 197.20000457763672)" class="edgeLabel"><g transform="translate(-29.100000381469727, -9.300000190734863)" class="label"><foreignObject height="18.600000381469727" width="58.20000076293945"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">price_id</span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(924.8922119140625, 71.80000114440918)" id="flowchart-I-1360" class="node default default flowchart-label"><rect height="33.60000038146973" width="138.12187957763672" y="-16.800000190734863" x="-69.06093978881836" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-61.56093978881836, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="123.12187957763672"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Cost Sheet Model</span></div></foreignObject></g></g><g transform="translate(924.8922119140625, 155.40000343322754)" id="flowchart-J-1361" class="node default default flowchart-label"><rect height="33.60000038146973" width="109.40625" y="-16.800000190734863" x="-54.703125" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-47.203125, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="94.40625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Margin Model</span></div></foreignObject></g></g><g transform="translate(1084.1953353881836, 113.60000228881836)" id="flowchart-O-1362" class="node default default flowchart-label"><rect height="33.60000038146973" width="80.484375" y="-16.800000190734863" x="-40.2421875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-32.7421875, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="65.484375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Database</span></div></foreignObject></g></g><g transform="translate(1269.1828384399414, 71.80000114440918)" id="flowchart-K-1356" class="node default default flowchart-label"><rect height="33.60000038146973" width="98.19375610351562" y="-16.800000190734863" x="-49.09687805175781" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-41.59687805175781, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="83.19375610351562"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">cost_sheets</span></div></foreignObject></g></g><g transform="translate(1269.1828384399414, 155.40000343322754)" id="flowchart-L-1357" class="node default default flowchart-label"><rect height="33.60000038146973" width="139.49063110351562" y="-16.800000190734863" x="-69.74531555175781" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-62.24531555175781, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="124.49063110351562"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">cost_sheet_items</span></div></foreignObject></g></g><g transform="translate(1486.4656562805176, 113.60000228881836)" id="flowchart-M-1358" class="node default default flowchart-label"><rect height="33.60000038146973" width="64.76250076293945" y="-16.800000190734863" x="-32.38125038146973" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-24.881250381469727, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="49.76250076293945"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">meters</span></div></foreignObject></g></g><g transform="translate(1486.4656562805176, 197.20000457763672)" id="flowchart-N-1359" class="node default default flowchart-label"><rect height="33.60000038146973" width="57.81562805175781" y="-16.800000190734863" x="-28.907814025878906" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-21.407814025878906, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="42.81562805175781"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">prices</span></div></foreignObject></g></g><g transform="translate(491.3406448364258, 71.80000114440918)" id="flowchart-E-1352" class="node default default flowchart-label"><rect height="33.60000038146973" width="147.50625610351562" y="-16.800000190734863" x="-73.75312805175781" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-66.25312805175781, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="132.50625610351562"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Cost Sheet Service</span></div></foreignObject></g></g><g transform="translate(685.4625244140625, 71.80000114440918)" id="flowchart-F-1353" class="node default default flowchart-label"><rect height="33.60000038146973" width="124.40626525878906" y="-16.800000190734863" x="-62.20313262939453" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-54.70313262939453, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="109.40626525878906"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Cost Calculator</span></div></foreignObject></g></g><g transform="translate(491.3406448364258, 155.40000343322754)" id="flowchart-G-1354" class="node default default flowchart-label"><rect height="33.60000038146973" width="118.80000305175781" y="-16.800000190734863" x="-59.400001525878906" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-51.900001525878906, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="103.80000305175781"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Margin Service</span></div></foreignObject></g></g><g transform="translate(685.4625244140625, 155.40000343322754)" id="flowchart-H-1355" class="node default default flowchart-label"><rect height="33.60000038146973" width="140.7375030517578" y="-16.800000190734863" x="-70.3687515258789" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-62.868751525878906, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="125.73750305175781"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Margin Calculator</span></div></foreignObject></g></g><g transform="translate(83.87968826293945, 71.80000114440918)" id="flowchart-A-1348" class="node default default flowchart-label"><rect height="33.60000038146973" width="117.7593765258789" y="-16.800000190734863" x="-58.87968826293945" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-51.37968826293945, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="102.7593765258789"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Cost Sheet API</span></div></foreignObject></g></g><g transform="translate(255.17344665527344, 71.80000114440918)" id="flowchart-B-1349" class="node default default flowchart-label"><rect height="33.60000038146973" width="124.82814025878906" y="-16.800000190734863" x="-62.41407012939453" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-54.91407012939453, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="109.82814025878906"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Cost Sheet DTO</span></div></foreignObject></g></g><g transform="translate(83.87968826293945, 155.40000343322754)" id="flowchart-C-1350" class="node default default flowchart-label"><rect height="33.60000038146973" width="89.05313110351562" y="-16.800000190734863" x="-44.52656555175781" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-37.02656555175781, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="74.05313110351562"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Margin API</span></div></foreignObject></g></g><g transform="translate(255.17344665527344, 155.40000343322754)" id="flowchart-D-1351" class="node default default flowchart-label"><rect height="33.60000038146973" width="96.11250305175781" y="-16.800000190734863" x="-48.056251525878906" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-40.556251525878906, -9.300000190734863)" style="" class="label"><rect/><foreignObject height="18.600000381469727" width="81.11250305175781"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Margin DTO</span></div></foreignObject></g></g></g></g></g></svg>